<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Web Snippets</title>
  
  <subtitle>code，food，english，history</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://ywxgod.github.io/blog/"/>
  <updated>2019-10-29T01:27:05.083Z</updated>
  <id>https://ywxgod.github.io/blog/</id>
  
  <author>
    <name>wyin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>001 - Object相关</title>
    <link href="https://ywxgod.github.io/blog/2019/10/29/jsinfo/object/"/>
    <id>https://ywxgod.github.io/blog/2019/10/29/jsinfo/object/</id>
    <published>2019-10-29T01:25:01.643Z</published>
    <updated>2019-10-29T01:27:05.083Z</updated>
    
    <content type="html"><![CDATA[<p>003 - JS Objects</p><p>[TOC]</p><hr><h2 id="Object属性操作"><a href="#Object属性操作" class="headerlink" title="Object属性操作"></a>Object属性操作</h2><p>object的属性只能是任意字符串，如果给定非字符串，JS会将其转为字符串。<br>实践中最好使用简单数据类型，如：字符串，Symbol，数字等，属性可以是JS保留字，如：<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保留字</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">for</span>:<span class="number">1</span>,<span class="attr">return</span>:<span class="number">2</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj.for, obj.return); <span class="comment">// 1, 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非字符串属性</span></span><br><span class="line"><span class="keyword">let</span> sym = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>);</span><br><span class="line">obj = &#123;[sym]:<span class="number">1</span>&#125;</span><br><span class="line">alert(obj.sym, obj[sym]); <span class="comment">// undefined, 1 </span></span><br><span class="line"><span class="built_in">console</span>.log(obj); <span class="comment">// &#123;Symbol(sym): 1&#125; JS会调用Symbol的toString()方法将sym转为字符串,所以并不存在sym属性，而是Symbol(sym)属性</span></span><br></pre></td></tr></table></figure></p><p><code>虽然可以用保留字，但实践中最好还是不要这么做。</code></p><p>删除属性可以用delete，访问某个属性直接用object.prop，也可以用object[‘prop’]，属性<strong>proto</strong>无法被修改。</p><h2 id="如何判断属性是否存在"><a href="#如何判断属性是否存在" class="headerlink" title="如何判断属性是否存在"></a>如何判断属性是否存在</h2><p>要判断某个属性是否存在于一个对象，可以用in操作符。in操作符会先查找对象本身，然后再在原型链上查找，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断age属性是否存在</span></span><br><span class="line">user = &#123;<span class="attr">name</span>:<span class="string">'wyin'</span>, <span class="attr">email</span>:<span class="string">'ywxgod@gmail.com'</span>,<span class="attr">age</span>: <span class="literal">undefined</span>&#125;</span><br><span class="line">user2 = <span class="built_in">Object</span>.create(user);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'age'</span> <span class="keyword">in</span> user); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'age'</span> <span class="keyword">in</span> user2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恰好需要判断的属性值为undefined的时候，如果用 typeof user.age === 'undefined' 来判断就会错误</span></span><br></pre></td></tr></table></figure><h2 id="如何获取全部属性"><a href="#如何获取全部属性" class="headerlink" title="如何获取全部属性"></a>如何获取全部属性</h2><table><thead><tr><th>方法</th><th>属性类型</th><th>对象本身</th><th>原型链对象</th></tr></thead><tbody><tr><td>Object.keys(obj)</td><td>只能获取字符串类型的属性</td><td>只能获取对象本身的属性</td><td>对象的原型上的属性无法获取</td></tr><tr><td>Object.getOwnPropertyNames(obj)</td><td>只能获取字符串类型的属性</td><td>只能获取对象本身的属性</td><td>对象的原型上的属性无法获取</td></tr><tr><td>Object.getOwnPropertySymbols(obj)</td><td>只能获取Symbol类型的属性</td><td>只能获取对象本身的属性</td><td>对象的原型上的属性无法获取</td></tr><tr><td>Reflet.ownKeys(obj)</td><td>可以获取所有类型属性</td><td>只能获取对象本身的属性</td><td>对象的原型上的属性无法获取</td></tr></tbody></table><p>代码示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sym = <span class="built_in">Symbol</span>(<span class="string">'mysym'</span>);</span><br><span class="line">user = &#123;<span class="attr">name</span>:<span class="string">'wyin'</span>, <span class="attr">email</span>:<span class="string">'ywxgod@gmail.com'</span>,<span class="attr">age</span>: <span class="literal">undefined</span>, [sym]: <span class="string">'web'</span>&#125;</span><br><span class="line">user2 = <span class="built_in">Object</span>.create(user);</span><br><span class="line">user2.task = <span class="string">'translate'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(user)); <span class="comment">// (3) ["name", "email", "age"]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(user2)); <span class="comment">// ["task"]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(user)); <span class="comment">// (3) ["name", "email", "age"]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(user2)); <span class="comment">// ["task"]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(user)); <span class="comment">// [Symbol(mysym)]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(user2)); <span class="comment">// []</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.ownKeys(user)); <span class="comment">// (4) ["name", "email", "age", Symbol(mysym)]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.ownKeys(user2)); <span class="comment">// ["task"]</span></span><br></pre></td></tr></table></figure><p>上面四种方法，全部都是针对对象本身获取属性，我们无法获取到原型上的属性。<br>如果只是要获取字符串类型的属性，我们可以用Object.keys()或者Object.getOwnPropertyNames()。<br>如果要获取Symbol类型的属性，我们可以用Object.getOwnPropertySymbols()。<br>如果要获取全部属性，则需要用Reflect.ownKeys()。</p><h2 id="如何遍历全部属性"><a href="#如何遍历全部属性" class="headerlink" title="如何遍历全部属性"></a>如何遍历全部属性</h2><p>遍历属性一般可以采用下面两种方法：</p><h3 id="for…in"><a href="#for…in" class="headerlink" title="for…in"></a>for…in</h3><p>for…in遍历的时候会对能转为整数的字符串属性进行排序，而其他的字符串属性会按照创建顺序遍历。所谓‘能转为整数的字符串属性’，指的是用String(Math.trunc(Number(prop)))===prop的属性，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> codes = &#123;</span><br><span class="line">  <span class="string">"49"</span>: <span class="string">"Germany"</span>,</span><br><span class="line">  <span class="string">"41"</span>: <span class="string">"Switzerland"</span>,</span><br><span class="line">  <span class="string">"44"</span>: <span class="string">"Great Britain"</span>,</span><br><span class="line">  <span class="string">"1"</span>: <span class="string">"USA"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> code <span class="keyword">in</span> codes)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(code, codes[code]); <span class="comment">// 1, 41, 44, 49</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于数字属性，遍历时为了保证其创建顺序，我们可以在每个属性之前加一个 + ，遍历的时候读取的是字符串 ‘+n’，使用的时候再转为数字，所以我们用一元操作符 + ，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> codes = &#123;</span><br><span class="line">  <span class="string">"+49"</span>: <span class="string">"Germany"</span>,</span><br><span class="line">  <span class="string">"+41"</span>: <span class="string">"Switzerland"</span>,</span><br><span class="line">  <span class="string">"+44"</span>: <span class="string">"Great Britain"</span>,</span><br><span class="line">  <span class="string">"+1"</span>: <span class="string">"USA"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> code <span class="keyword">in</span> codes) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log( +code, codes[code]); <span class="comment">// 49, 41, 44, 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="先获取到需要的属性，再用数组的方式遍历"><a href="#先获取到需要的属性，再用数组的方式遍历" class="headerlink" title="先获取到需要的属性，再用数组的方式遍历"></a>先获取到需要的属性，再用数组的方式遍历</h3><p>这种方式是将上面的四种方法，根据需要使用即可。</p><h2 id="浅复制"><a href="#浅复制" class="headerlink" title="浅复制"></a>浅复制</h2><p>目前比较常用的是用Object.assign,或者扩展运算符 … ，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">user = &#123;</span><br><span class="line">    name:<span class="string">'wyin'</span>, </span><br><span class="line">    email:<span class="string">'ywxgod@gmail.com'</span>,</span><br><span class="line">    age: <span class="literal">undefined</span>, </span><br><span class="line">    [sym]: <span class="string">'web'</span>, </span><br><span class="line">    <span class="string">'+12'</span>: <span class="number">12</span>, </span><br><span class="line">    <span class="string">'3.2'</span>:<span class="number">23</span>, </span><br><span class="line">    speak: <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;, </span><br><span class="line">    walk: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;, </span><br><span class="line">    birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(), </span><br><span class="line">    books:[<span class="string">'book1'</span>,<span class="string">'book2'</span>],</span><br><span class="line">    task: &#123;</span><br><span class="line">        walk: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userCopied = &#123;...user&#125;;</span><br><span class="line">userCopied.books[<span class="number">0</span>] = <span class="string">'apple'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(user.books); <span class="comment">// ["apple", "book2"]</span></span><br></pre></td></tr></table></figure><h2 id="深复制"><a href="#深复制" class="headerlink" title="深复制"></a>深复制</h2><h3 id="v8-serialize-amp-amp-v8-deserialize"><a href="#v8-serialize-amp-amp-v8-deserialize" class="headerlink" title="v8.serialize&amp;&amp;v8.deserialize"></a>v8.serialize&amp;&amp;v8.deserialize</h3><p>这两个方法是Node11才有的，浏览器环境暂时不支持。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> v8 = <span class="built_in">require</span>(<span class="string">'v8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> structuredClone = <span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> v8.deserialize(v8.serialize(obj));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="JSON-stringify-amp-amp-JSON-parse"><a href="#JSON-stringify-amp-amp-JSON-parse" class="headerlink" title="JSON.stringify&amp;&amp;JSON.parse"></a>JSON.stringify&amp;&amp;JSON.parse</h3><p>最好应用在比较小的原始对象上，且对象的属性值最好是简单类型(symbol除外)。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plainObj = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>, <span class="attr">d</span>:[<span class="number">1</span>,<span class="number">2</span>], <span class="attr">e</span>:<span class="literal">true</span>&#125;;</span><br><span class="line">plainObjCopied = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(plainObj));</span><br><span class="line"><span class="built_in">console</span>.log(plainObjCopied); <span class="comment">// &#123;a: 1, b: 2, c: 3, d: Array(2), e: true&#125;</span></span><br></pre></td></tr></table></figure><p>对于其他类型，它会丢失。如值为函数、undefined，Symbol属性。对于自定义类型且复制后不保证数据类型，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sym = <span class="built_in">Symbol</span>(<span class="string">'mysym'</span>);</span><br><span class="line">user = &#123;</span><br><span class="line">    name:<span class="string">'wyin'</span>, </span><br><span class="line">    email:<span class="string">'ywxgod@gmail.com'</span>,</span><br><span class="line">    age: <span class="literal">undefined</span>, </span><br><span class="line">    [sym]: <span class="string">'web'</span>, </span><br><span class="line">    <span class="string">'+12'</span>: <span class="number">12</span>, </span><br><span class="line">    <span class="string">'3.2'</span>:<span class="number">23</span>, </span><br><span class="line">    speak: <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;, </span><br><span class="line">    walk: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;, </span><br><span class="line">    birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(), </span><br><span class="line">    books:[<span class="string">'book1'</span>,<span class="string">'book2'</span>],</span><br><span class="line">    task: &#123;</span><br><span class="line">        walk: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">user2 = <span class="built_in">Object</span>.create(user);</span><br><span class="line">user2.task = <span class="string">'translate'</span>;</span><br><span class="line"></span><br><span class="line">userCopy = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(user));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.ownKeys(userCopy)); <span class="comment">// ["name", "email", "+12", "3.2", "birthday", "books", "task"]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> userCopy.birthday); <span class="comment">// string , Date类型变成了String</span></span><br><span class="line"><span class="built_in">console</span>.log(userCopy.task); <span class="comment">// &#123;walk: 2&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(userCopy.books); <span class="comment">// ["book1", "book2"]</span></span><br><span class="line"></span><br><span class="line">userCopy2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(user2));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.ownKeys(userCopy2)); <span class="comment">// ["task"] 只会序列号本身属性</span></span><br></pre></td></tr></table></figure><h3 id="根据不同的类型逐个属性复制对象"><a href="#根据不同的类型逐个属性复制对象" class="headerlink" title="根据不同的类型逐个属性复制对象"></a>根据不同的类型逐个属性复制对象</h3><ol><li>对于简单类型，null，undefined我们只需要直接复制就可以。</li><li>对于数组，先创建一个空数组，再逐个判断每个数组元素的类型进行复制，直到都是简单类型。</li><li>对于Date类型，先创建一个Date对象，然后将其时间戳设置给新对象即可。</li><li>对于object类型，循环遍历所有属性，根据属性值类型逐个判断。</li></ol><p>下面是在某个js库中发现的方法，稍微改了一下。（是哪个库，记不得了~！:cry:）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> copy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle the 3 simple types, and null or undefined</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> == obj || <span class="string">"object"</span> != <span class="keyword">typeof</span> obj) <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle Date</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">        copy = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        copy.setTime(obj.getTime());</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle Array</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">        copy = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = obj.length; i &lt; len; i++) &#123;</span><br><span class="line">            copy[i] = clone(obj[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle Object</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">        copy = &#123;&#125;;</span><br><span class="line">        <span class="comment">// 用for...in无法遍历到Symbol类型的属性</span></span><br><span class="line">        <span class="comment">// for (var attr in obj) &#123;</span></span><br><span class="line">        <span class="comment">// if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">let</span> keys = <span class="built_in">Reflect</span>.ownKeys(obj);</span><br><span class="line">        keys.forEach(<span class="function"><span class="params">attr</span>=&gt;</span>&#123;</span><br><span class="line">            copy[attr] = clone(obj[attr])</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Unable to copy obj! Its type isn't supported."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sym = <span class="built_in">Symbol</span>(<span class="string">'mysym'</span>);</span><br><span class="line">user = &#123;</span><br><span class="line">    name:<span class="string">'wyin'</span>, </span><br><span class="line">    email:<span class="string">'ywxgod@gmail.com'</span>,</span><br><span class="line">    age: <span class="literal">undefined</span>, </span><br><span class="line">    [sym]: <span class="string">'web'</span>, </span><br><span class="line">    <span class="string">'+12'</span>: <span class="number">12</span>, </span><br><span class="line">    <span class="string">'3.2'</span>:<span class="number">23</span>, </span><br><span class="line">    speak: <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;, </span><br><span class="line">    walk: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;, </span><br><span class="line">    birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(), </span><br><span class="line">    books:[<span class="string">'book1'</span>,<span class="string">'book2'</span>],</span><br><span class="line">    task: &#123;</span><br><span class="line">        walk: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userCopied = clone(user);</span><br><span class="line"><span class="built_in">console</span>.log(userCopied);</span><br><span class="line"><span class="comment">// chrome 控制台输出</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;name: "wyin", email: "ywxgod@gmail.com", age: undefined, +12: 12, 3.2: 23, …&#125;</span></span><br><span class="line"><span class="comment">3.2: 23</span></span><br><span class="line"><span class="comment">+12: 12</span></span><br><span class="line"><span class="comment">age: undefined</span></span><br><span class="line"><span class="comment">birthday: Tue Oct 29 2019 09:10:11 GMT+0800 (中国标准时间) &#123;&#125;</span></span><br><span class="line"><span class="comment">books: (2) ["book1", "book2"]</span></span><br><span class="line"><span class="comment">email: "ywxgod@gmail.com"</span></span><br><span class="line"><span class="comment">name: "wyin"</span></span><br><span class="line"><span class="comment">speak: ()=&gt;&#123;&#125;</span></span><br><span class="line"><span class="comment">task: &#123;walk: 2&#125;</span></span><br><span class="line"><span class="comment">walk: ƒ ()</span></span><br><span class="line"><span class="comment">Symbol(mysym): "web"</span></span><br><span class="line"><span class="comment">__proto__: Object</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="利用一些现有库方法，如lodash的deepCopy"><a href="#利用一些现有库方法，如lodash的deepCopy" class="headerlink" title="利用一些现有库方法，如lodash的deepCopy"></a>利用一些现有库方法，如lodash的deepCopy</h3><p>具体可以参考lodash的文档。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;003 - JS Objects&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;Object属性操作&quot;&gt;&lt;a href=&quot;#Object属性操作&quot; class=&quot;headerlink&quot; title=&quot;Object属性操作&quot;&gt;&lt;/a&gt;Object属性操作&lt;/h2&gt;&lt;p&gt;object的属性只能是任意字符串，如果给定非字符串，JS会将其转为字符串。&lt;br&gt;实践中最好使用简单数据类型，如：字符串，Symbol，数字等，属性可以是JS保留字，如：&lt;br&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="Object" scheme="https://ywxgod.github.io/blog/tags/Object/"/>
    
  </entry>
  
  <entry>
    <title>TS项目如何开始及基本类型介绍</title>
    <link href="https://ywxgod.github.io/blog/2019/10/24/ts/base_types/"/>
    <id>https://ywxgod.github.io/blog/2019/10/24/ts/base_types/</id>
    <published>2019-10-23T17:34:03.500Z</published>
    <updated>2019-10-23T17:41:58.471Z</updated>
    
    <content type="html"><![CDATA[<h2 id="从typescript源文件到执行的过程"><a href="#从typescript源文件到执行的过程" class="headerlink" title="从typescript源文件到执行的过程"></a>从typescript源文件到执行的过程</h2><a id="more"></a><table><thead><tr><th>执行者</th><th>步骤</th><th>说明</th></tr></thead><tbody><tr><td>TSC</td><td>1. TypeScript Source -&gt; TypeScript AST</td><td>TSC将ts文件转为TS AST(abstract syntax tree)</td></tr><tr><td>TSC</td><td>2. AST is checked by typechecker</td><td>TSC的类型检查器对AST做类型检查</td></tr><tr><td>TSC</td><td>3. TypeScript AST -&gt; Javascript Source</td><td>TSC将TS AST转为JS的源代码(可能是ES3/5/6)</td></tr><tr><td>JS(浏览器/Node.js)</td><td>4. Javascript Source -&gt; Javascript AST</td><td>JS运行时将JS源码转为JS AST</td></tr><tr><td>JS(浏览器/Node.js)</td><td>5. Javascript AST -&gt; bytecode</td><td>JS运行时将JS AST 转为字节码，准备运行</td></tr><tr><td>JS(浏览器/Node.js)</td><td>6. Bytecode is evaluated by runtime</td><td>JS运行时运行js字节码</td></tr></tbody></table><p>其中1-3步是TSC处理的，4-6步为JS运行时处理，可能是浏览器也可能是Node.js。</p><p>从上面步骤可以知道，TSC做类型检查是在将TS AST转为JS源码之前，也就是说从TS AST转为JS源码时，是没有做类型检查的。检查类型时针对TS AST的，即第二步。</p><p>也意味着TS的类型系统，强类型的各种机制，仅仅对类型检查有用，对产出的JS无影响，增加类型不会污染JS源文件。</p><h2 id="关于tsconfig-json"><a href="#关于tsconfig-json" class="headerlink" title="关于tsconfig.json"></a>关于tsconfig.json</h2><p>可以通过 tsc –init 创建tsconfig.json文件，如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    "target": "es2015",                          /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019' or 'ESNEXT'. */</span><br><span class="line">    "module": "commonjs",                     /* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', or 'ESNext'. */</span><br><span class="line">    "lib": ["es2015"],                             /* Specify library files to be included in the compilation. */</span><br><span class="line">    "sourceMap": true,                     /* Generates corresponding '.map' file. */</span><br><span class="line">    // "outFile": "./",                       /* Concatenate and emit output to single file. */</span><br><span class="line">    "outDir": "dist",                        /* Redirect output structure to the directory. */</span><br><span class="line">    "strict": true,                           /* Enable all strict type-checking options. */</span><br><span class="line">    "noImplicitAny": true,                 /* Raise error on expressions and declarations with an implied 'any' type. */</span><br><span class="line">    "alwaysStrict": true,                  /* Parse in strict mode and emit "use strict" for each source file. */</span><br><span class="line">    "esModuleInterop": true                   /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies 'allowSyntheticDefaultImports'. */</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面主要看几个常用配置：</p><table><thead><tr><th>配置属性</th><th>描述</th></tr></thead><tbody><tr><td>include</td><td>告诉TSC在哪里找到ts文件</td></tr><tr><td>lib</td><td>告诉TSC当前运行时已存在的API，通常包括：ES5的bind，新增数组方法，ES6的新增方法等</td></tr><tr><td>module</td><td>告诉TSC将ts文件转为那种模块标准的js文件，通常有cmj，cmd，es6等</td></tr><tr><td>outDir</td><td>告诉TSC将转换后的文件放到哪个目录</td></tr><tr><td>strict</td><td>告诉TSC是否进行严格的类型检查</td></tr><tr><td>target</td><td>告诉TSC将ts转换成哪个版本的js，通常有ES3，ES5，ES6等</td></tr><tr><td>noImplicitAny</td><td>是否允许存在未定义的类型，即隐式类型。TSC不会自己猜测类型</td></tr><tr><td>alwaysStrict</td><td>TSC会在产出的每个js文件中带上use strict语句</td></tr></tbody></table><h2 id="关于tslint"><a href="#关于tslint" class="headerlink" title="关于tslint"></a>关于tslint</h2><p>可以通过 tslint –init 创建默认的tslint.json文件，如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"defaultSeverity"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="attr">"extends"</span>: [</span><br><span class="line">        <span class="string">"tslint:recommended"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"jsRules"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"rules"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"rulesDirectory"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类型"><a href="#类型" class="headerlink" title="{}类型"></a>{}类型</h2><p>当将一个变量设置为{}类型是，意味着此变量的值可以是除了null和undefined之外的任何值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a:&#123;&#125; = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b:&#123;&#125; = <span class="built_in">Symbol</span>(<span class="string">'b'</span>);</span><br><span class="line"><span class="keyword">let</span> c:&#123;&#125; = <span class="literal">null</span>; <span class="comment">// Type 'null' is not assignable to type '&#123;&#125;'.</span></span><br><span class="line"><span class="keyword">let</span> d:&#123;&#125; = <span class="literal">undefined</span>; <span class="comment">// Type 'undefined' is not assignable to type '&#123;&#125;'.</span></span><br></pre></td></tr></table></figure><h2 id="object类型"><a href="#object类型" class="headerlink" title="object类型"></a>object类型</h2><p>当将一个变量设置为object类型时，意味着此变量的值可以是除了字符串，数字，Symbol，null，undefined，布尔值之外的任何值。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a:object = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">let</span> b:object = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> c:object = [];</span><br><span class="line"><span class="keyword">let</span> d:object = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">''</span>);</span><br><span class="line"><span class="keyword">let</span> e:object = <span class="literal">true</span>; <span class="comment">// Type 'true' is not assignable to type 'object'.</span></span><br><span class="line"><span class="keyword">let</span> f:object = <span class="built_in">Symbol</span>(); <span class="comment">// Type 'symbol' is not assignable to type 'object'.</span></span><br><span class="line"><span class="keyword">let</span> g:object = <span class="number">1</span>; <span class="comment">// Type '1' is not assignable to type 'object'.</span></span><br><span class="line"><span class="keyword">let</span> h:object = <span class="string">'1'</span>; <span class="comment">// Type '"1"' is not assignable to type 'object'.</span></span><br></pre></td></tr></table></figure><h2 id="Object类型"><a href="#Object类型" class="headerlink" title="Object类型"></a>Object类型</h2><p>同{}类型。</p><table><thead><tr><th>Value</th><th>{}</th><th>object</th><th>Object</th></tr></thead><tbody><tr><td>{}</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>[‘a’]</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>function(){}</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>new String(‘a’)</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>‘a’</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>1</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Symbol()</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>true</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>null</td><td>No</td><td>No</td><td>No</td></tr><tr><td>undefined</td><td>No</td><td>No</td><td>No</td></tr></tbody></table><h2 id="类型-1"><a href="#类型-1" class="headerlink" title="[]类型"></a>[]类型</h2><p>当一个变量声明为[]类型时，表示变量的值必须为空数组。如果隐式声明为[],则表示元素的类型为any，即任意类型的值。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a:[] = [];</span><br><span class="line">a = [<span class="number">1</span>]; <span class="comment">// Type '[number]' is not assignable to type '[]'.</span></span><br><span class="line"><span class="keyword">let</span> b = []; <span class="comment">// 隐式声明b为数组，元素类型是any类型</span></span><br><span class="line">b.push(<span class="number">1</span>);</span><br><span class="line">b.push(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h2 id="Tuples类型"><a href="#Tuples类型" class="headerlink" title="Tuples类型"></a>Tuples类型</h2><p>此类型是array的子类型，继承自array类型。Tuples类型的数组必须显式申明其元素的类型，且数组长度不可变。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明定长的数组</span></span><br><span class="line"><span class="keyword">let</span> arr: [string,number,boolean] = [<span class="string">'a'</span>,<span class="number">2</span>,<span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二维数组的声明</span></span><br><span class="line"><span class="comment">// 分步解释：</span></span><br><span class="line"><span class="comment">// let data: number[] 表示声明一个元素为数字的数组</span></span><br><span class="line"><span class="comment">// let data: [][] 表示声明一个元素为空数组的数组</span></span><br><span class="line"><span class="comment">// let data: [number, number][] 表示声明一个元素为两个元素的tuples类型的数组，且tuples的两个元素必须都为number类型</span></span><br><span class="line"><span class="comment">// let data: [number, number?][] 表示数组的第二个元素可选</span></span><br><span class="line"><span class="keyword">let</span> data: [number, number?][] = [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明不定长数组，且指定第一个元素的类型，其他元素类型任意</span></span><br><span class="line"><span class="keyword">let</span> data1: [string,...any[]] = [<span class="string">'11'</span>,<span class="string">'s'</span>,<span class="number">32</span>];</span><br></pre></td></tr></table></figure><h2 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h2><p>枚举类型主要处理两类事务：定义字符串到数字的映射或字符串到字符串的映射。TS会自动将枚举类型的每个成员映射到一个数字，默认是从0开始，也可是是显式定义数字，开始位置自己决定，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认从0开始</span></span><br><span class="line">enum lang &#123;Chinese, English, Russian&#125;; </span><br><span class="line"><span class="keyword">let</span> a = lang.Chinese;</span><br><span class="line"><span class="built_in">console</span>.log(a, lang.English, lang.Russian); <span class="comment">// 0, 1, 2</span></span><br><span class="line"><span class="comment">// 定义从3开始</span></span><br><span class="line">enum lang &#123;Chinese=<span class="number">3</span>, English, Russian&#125;; </span><br><span class="line"><span class="keyword">let</span> a = lang.Chinese;</span><br><span class="line"><span class="built_in">console</span>.log(a, lang.English, lang.Russian); <span class="comment">// 3, 4, 5</span></span><br><span class="line"><span class="comment">// 自定义或者自动赋值</span></span><br><span class="line">enum lang &#123;Chinese=<span class="number">3</span>, English=<span class="number">6</span>, Russian&#125;; </span><br><span class="line"><span class="keyword">let</span> a = lang.Chinese;</span><br><span class="line"><span class="built_in">console</span>.log(a, lang.English, lang.Russian); <span class="comment">// 3, 6, 7</span></span><br></pre></td></tr></table></figure><p>看枚举类型被TS转换后的形式，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lang;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">lang</span>) </span>&#123;</span><br><span class="line">    lang[lang[<span class="string">"Chinese"</span>] = <span class="number">3</span>] = <span class="string">"Chinese"</span>;</span><br><span class="line">    lang[lang[<span class="string">"English"</span>] = <span class="number">9</span>] = <span class="string">"English"</span>;</span><br><span class="line">    lang[lang[<span class="string">"Russian"</span>] = <span class="number">10</span>] = <span class="string">"Russian"</span>;</span><br><span class="line">&#125;)(lang || (lang = &#123;&#125;));</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>我们可以通过数字访问到字符串，通过字符串访问到数字，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(lang[<span class="string">'English'</span>], lang[lang.English]); <span class="comment">// 9 English</span></span><br></pre></td></tr></table></figure><h2 id="readonly修饰符"><a href="#readonly修饰符" class="headerlink" title="readonly修饰符"></a>readonly修饰符</h2><p>声明对象的某个属性为readonly</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: &#123;<span class="attr">a</span>:string, readonly b:number&#125; = &#123;<span class="attr">a</span>:<span class="string">'2'</span>, <span class="attr">b</span>:<span class="number">3</span>&#125;;</span><br><span class="line">a.b = <span class="number">4</span>; <span class="comment">// Cannot assign to 'b' because it is a read-only property.</span></span><br></pre></td></tr></table></figure><p>声明数组为只读</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">as</span>: readonly number[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">as</span>.push(<span class="number">2</span>); <span class="comment">// Property 'push' does not exist on type 'readonly number[]'.</span></span><br><span class="line"><span class="keyword">as</span>.concat(<span class="number">3</span>); <span class="comment">// concat函数不会对原数组修改，而是返回新的数组，所以此处合法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以这样声明</span></span><br><span class="line"><span class="keyword">let</span> arr: ReadonlyArray&lt;string&gt; = [<span class="string">'2'</span>];</span><br><span class="line">arr.push(<span class="string">'3'</span>); <span class="comment">// Property 'push' does not exist on type 'readonly string[]'.</span></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">let</span> arr: Readonly&lt;string[]&gt; = [<span class="string">'22'</span>];</span><br></pre></td></tr></table></figure><p>声明类的属性为只读。类的只读属性可以在声明的时候赋值，或者构造函数中赋值，其他地方都不允许赋值。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span>&#123;</span><br><span class="line">    readonly bar = <span class="number">1</span>;</span><br><span class="line">    readonly baz:string;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.baz = <span class="string">'hello'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setBaz(value:string)&#123;</span><br><span class="line">        <span class="keyword">this</span>.baz = value; <span class="comment">// Cannot assign to 'baz' because it is a read-only property.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Foo().baz);</span><br></pre></td></tr></table></figure><h2 id="类型的组合"><a href="#类型的组合" class="headerlink" title="类型的组合"></a>类型的组合</h2><p>有时候某个变量的值可能需要取其他类型中的某一个类型，这时可以给此变量的类型设置为这些类型的并集，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> prop: string|number = <span class="number">3</span>;</span><br><span class="line">prop = <span class="string">'3'</span>; <span class="comment">// 可以被赋值，因为prop可以为string和number类型中的一个</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组里可以是字符串也可以是数字</span></span><br><span class="line">type StringOrNumber = string|number;</span><br><span class="line"><span class="keyword">let</span> a: StringOrNumber[] = []; <span class="comment">// 或者直接这样：let a: (string|number)[] = [];</span></span><br><span class="line">a.push(<span class="number">1</span>);</span><br><span class="line">a.push(<span class="string">'a'</span>);</span><br><span class="line">a.push(<span class="literal">true</span>); <span class="comment">// 类型错误，不可以有布尔类型</span></span><br><span class="line"></span><br><span class="line">type Cat = &#123;<span class="attr">name</span>:string, <span class="attr">purrs</span>:boolean&#125;;</span><br><span class="line">type Dog = &#123;<span class="attr">name</span>:string, <span class="attr">barks</span>:boolean, <span class="attr">wags</span>:boolean&#125;</span><br><span class="line">type CatOrDogOrBoth = Cat|Dog;</span><br><span class="line"><span class="keyword">let</span> cat: CatOrDogOrBoth = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">purrs</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"><span class="comment">// 类型错误 &#123;name: 'John', barks: false&#125; 不属于Cat和Dog中的任何一个类型</span></span><br><span class="line"><span class="keyword">let</span> cat2: CatOrDogOrBoth = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">barks</span>: <span class="literal">false</span>&#125;; </span><br><span class="line"><span class="comment">// 类型错误，同上</span></span><br><span class="line"><span class="keyword">let</span> cat3: CatOrDogOrBoth = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">wags</span>: <span class="literal">false</span>&#125;;</span><br><span class="line"><span class="comment">// 类型错误， 同上</span></span><br><span class="line"><span class="keyword">let</span> cat4: CatOrDogOrBoth = &#123;<span class="attr">barks</span>: <span class="literal">true</span>, <span class="attr">wags</span>: <span class="literal">false</span>&#125;;</span><br><span class="line"><span class="comment">// 属于Cat类型，因为没有barks属性，即不是Dog类型，且完全拥有Cat类型定义的所有属性</span></span><br><span class="line"><span class="keyword">let</span> cat5: CatOrDogOrBoth = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">purrs</span>: <span class="literal">true</span>, <span class="attr">wags</span>: <span class="literal">false</span>&#125;;</span><br><span class="line"><span class="comment">// 既是Cat类型也是Dog类型</span></span><br><span class="line"><span class="keyword">let</span> cat6: CatOrDogOrBoth = &#123;<span class="attr">name</span>: <span class="string">'John'</span>, <span class="attr">barks</span>: <span class="literal">false</span>, <span class="attr">wags</span>: <span class="literal">false</span>, <span class="attr">purrs</span>:<span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;从typescript源文件到执行的过程&quot;&gt;&lt;a href=&quot;#从typescript源文件到执行的过程&quot; class=&quot;headerlink&quot; title=&quot;从typescript源文件到执行的过程&quot;&gt;&lt;/a&gt;从typescript源文件到执行的过程&lt;/h2&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="typescript" scheme="https://ywxgod.github.io/blog/tags/typescript/"/>
    
  </entry>
  
  <entry>
    <title>004 - Symbols介绍</title>
    <link href="https://ywxgod.github.io/blog/2019/10/18/jsinfo/symbols/"/>
    <id>https://ywxgod.github.io/blog/2019/10/18/jsinfo/symbols/</id>
    <published>2019-10-17T17:56:49.101Z</published>
    <updated>2019-10-17T17:58:25.105Z</updated>
    
    <content type="html"><![CDATA[<h2 id="对Symbol的三个认知："><a href="#对Symbol的三个认知：" class="headerlink" title="对Symbol的三个认知："></a>对Symbol的三个认知：</h2><ol><li>没有两个Symbol是相同的；</li><li>Symbol是一种简单类型，可以和字符串一样作为Object类型的键值，可以通过[ ]直接访问；</li><li>Symbol类型不可以隐式转换类型，且只可以进行显示调用sym.toString/String(sym)/Boolean(sym)进行转换，所以任何隐式转换的运算都会报错。</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> symbol1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> symbol2 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">obj[symbol1] = <span class="number">1</span>;</span><br><span class="line">obj[symbol2] = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj[symbol1]); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(obj[symbol2]); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> symbol1; <span class="comment">// 'symbol'</span></span><br><span class="line">symbol1 == symbol2; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">symbol1 + <span class="number">2</span>; <span class="comment">// TypeError</span></span><br><span class="line">symbol1.toString() + <span class="number">2</span>; <span class="comment">// 'Symbol()2'</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="创建Symbol的两种方法"><a href="#创建Symbol的两种方法" class="headerlink" title="创建Symbol的两种方法"></a>创建Symbol的两种方法</h2><ol><li>Symbol(‘description’) - description参数仅用与方便调试，toString时会输出。</li><li>Symbol.for(‘key’) - 相当于全局注册了一个Symbol，后续还可以找回来</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sym1 = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>);</span><br><span class="line"><span class="keyword">const</span> sym2 = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>);</span><br><span class="line">sym1 === sym2; <span class="comment">// false - 相同的description创建Symbol，也是不相等的。</span></span><br><span class="line"></span><br><span class="line">sym1 = <span class="built_in">Symbol</span>.for(<span class="string">'sym_for'</span>);</span><br><span class="line">sym2 = <span class="built_in">Symbol</span>.for(<span class="string">'sym_for'</span>);</span><br><span class="line">sym1 === sym2; <span class="comment">// true - 用同样的key</span></span><br></pre></td></tr></table></figure><p><strong>建议不要全局注册Symbol，因为很容易造成命名冲突。</strong></p><h2 id="遍历带有Symbol的对象"><a href="#遍历带有Symbol的对象" class="headerlink" title="遍历带有Symbol的对象"></a>遍历带有Symbol的对象</h2><p>Object.getOwnPropertyNames()只能获取对象的字符串类型的键值，要获取Symbol类型的键值可以用Object.getOwnPropertySymbols()，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>()]: <span class="number">3</span>,</span><br><span class="line">    name: <span class="string">'John'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj).forEach(<span class="function"><span class="params">i</span>=&gt;</span><span class="built_in">console</span>.log(i)); <span class="comment">// name</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(obj).forEach(<span class="function"><span class="params">i</span>=&gt;</span><span class="built_in">console</span>.log(i)); <span class="comment">// Symbol()</span></span><br></pre></td></tr></table></figure><p>Reflect.ownKeys()可以一次获取到所有类型的键值，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> props = <span class="built_in">Reflect</span>.ownKeys(obj)</span><br><span class="line"><span class="built_in">console</span>.log(props); <span class="comment">//  ["name", Symbol()]</span></span><br></pre></td></tr></table></figure><h2 id="Symbol作为类的私有属性"><a href="#Symbol作为类的私有属性" class="headerlink" title="Symbol作为类的私有属性"></a>Symbol作为类的私有属性</h2><p>对于每一个私有属性，可以创建一个Symbol，因为在类外部无法感知类的实例有这个属性。虽然无法通过类的实例直接反问，但不过我们还是可以通过getOwnPropertySymbols拿到所有私有属性，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _x = <span class="built_in">Symbol</span>(<span class="string">'x'</span>);</span><br><span class="line"><span class="keyword">const</span> _y = <span class="built_in">Symbol</span>(<span class="string">'y'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(x=0,y=0)&#123;</span><br><span class="line">        <span class="keyword">this</span>[_x] = x;</span><br><span class="line">        <span class="keyword">this</span>[_y] = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pt = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(pt._x); <span class="comment">// undefined - 不存在_x属性</span></span><br><span class="line"><span class="keyword">let</span> symbols = <span class="built_in">Object</span>.getOwnPropertySymbols(pt);</span><br><span class="line">pt[symbols[<span class="number">0</span>]] = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(pt); <span class="comment">// Point &#123;Symbol(x): 3, Symbol(y): 2&#125; - 属性Symbol('x')的值已经改为3</span></span><br></pre></td></tr></table></figure><h2 id="Symbol的类型转换"><a href="#Symbol的类型转换" class="headerlink" title="Symbol的类型转换"></a>Symbol的类型转换</h2><table><thead><tr><th>转为目标类型</th><th>显示转换</th><th>隐式转换</th></tr></thead><tbody><tr><td>boolean</td><td>Boolean(sym) —&gt; OK</td><td>!sym —&gt; OK</td></tr><tr><td>number</td><td>Number(sym) —&gt; TypeError</td><td>3 * sym —&gt; TypeError</td></tr><tr><td>string</td><td>String(sym) —&gt; OK</td><td>‘’ + sym —&gt; TypeError</td></tr><tr><td></td><td>sym.toString() —&gt; OK</td><td><code>${sym}</code> —&gt; TypeError</td></tr></tbody></table><h2 id="Symbol-iterator"><a href="#Symbol-iterator" class="headerlink" title="Symbol.iterator"></a>Symbol.iterator</h2><p>Symbol.iterator一般是作为对象键值出现，且值为一个固定格式的函数。具有Symbol.iterator的对象，我们认为是一个可迭代的对象(iterable)，你可以用for…of进行遍历。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iterateOver</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> iterable = &#123;</span><br><span class="line">        [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        next() &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; args.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="attr">value</span>: args[index++] &#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> iterable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>iterable的接口：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Iterable &#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.iterator]() : Iterator;</span><br><span class="line">&#125;</span><br><span class="line">interface Iterator &#123;</span><br><span class="line">    next() : IteratorResult;</span><br><span class="line">    <span class="keyword">return</span>?(value? : any) : IteratorResult;</span><br><span class="line">&#125;</span><br><span class="line">interface IteratorResult &#123;</span><br><span class="line">    value: any;</span><br><span class="line">    done: boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还有其他内建Symbols，比如：</p><p>Symbol.toPrimitive<br>Symbol.hasInstance<br>Symbol.toStringTag<br>Symbol.isConcatSpreadable</p><p>等等……</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;对Symbol的三个认知：&quot;&gt;&lt;a href=&quot;#对Symbol的三个认知：&quot; class=&quot;headerlink&quot; title=&quot;对Symbol的三个认知：&quot;&gt;&lt;/a&gt;对Symbol的三个认知：&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;没有两个Symbol是相同的；&lt;/li&gt;
&lt;li&gt;Symbol是一种简单类型，可以和字符串一样作为Object类型的键值，可以通过[ ]直接访问；&lt;/li&gt;
&lt;li&gt;Symbol类型不可以隐式转换类型，且只可以进行显示调用sym.toString/String(sym)/Boolean(sym)进行转换，所以任何隐式转换的运算都会报错。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; symbol1 = &lt;span class=&quot;built_in&quot;&gt;Symbol&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; symbol2 = &lt;span class=&quot;built_in&quot;&gt;Symbol&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; obj = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;obj[symbol1] = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;obj[symbol2] = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(obj[symbol1]); &lt;span class=&quot;comment&quot;&gt;// 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(obj[symbol2]); &lt;span class=&quot;comment&quot;&gt;// 2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; symbol1; &lt;span class=&quot;comment&quot;&gt;// &#39;symbol&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;symbol1 == symbol2; &lt;span class=&quot;comment&quot;&gt;// false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;symbol1 + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// TypeError&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;symbol1.toString() + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;// &#39;Symbol()2&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="code" scheme="https://ywxgod.github.io/blog/tags/code/"/>
    
  </entry>
  
  <entry>
    <title>003 - JS类型转换</title>
    <link href="https://ywxgod.github.io/blog/2019/10/17/jsinfo/type_conversion/"/>
    <id>https://ywxgod.github.io/blog/2019/10/17/jsinfo/type_conversion/</id>
    <published>2019-10-16T18:37:31.406Z</published>
    <updated>2019-10-16T18:40:39.589Z</updated>
    
    <content type="html"><![CDATA[<p>JS的类型一般有String，Number，Boolean，Symbol，null，undefined，Object这几种，其中前四种可以认为是简单类型，Object是复杂类型（包括Array，Date等），中间两种自成一体。</p><p>我们都知道JS是弱类型的语言，所以难免会进行类型转换，而转换又有显式和隐式之分。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> == <span class="literal">null</span><span class="comment">// false</span></span><br><span class="line"><span class="number">2</span> / <span class="string">'5'</span><span class="comment">// 0.4</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'3'</span>)<span class="comment">// 3</span></span><br><span class="line"><span class="number">1</span> === <span class="literal">null</span><span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>第一，二行会进行隐式转换，第三行是显式转换，而第四行不会转换类型。这里先讨论隐式转换，无论是简单类型还是复杂类型，隐式转为最后都会转为boolean，string或者number中的一种。</p><h2 id="什么时候会进行隐式转换，又会转为什么类型"><a href="#什么时候会进行隐式转换，又会转为什么类型" class="headerlink" title="什么时候会进行隐式转换，又会转为什么类型"></a>什么时候会进行隐式转换，又会转为什么类型</h2><a id="more"></a><ol><li><p>不同类型进行算术运算时会进行隐式转换，常用算术操作：+-*/</p><p>+：当有一个操作数是字符串时，另一个被转为字符串；都不是字符串时，则全部转为数字。<br>-*/：全部转为数字</p></li><li><p>不同类型进行比较操作时会进行隐式转换，常用比较操作：&gt; &lt; = &gt;= &lt;= != == !== ===</p><p>字符串：当两边都是字符串时，不转换。<br>只要有一边不是字符串，则全部转为数字进行比较。</p></li><li><p>作为函数参数传递时会根据参数类型进行隐式转换。</p></li></ol><h2 id="如何进行转换"><a href="#如何进行转换" class="headerlink" title="如何进行转换"></a>如何进行转换</h2><h3 id="简单类型的转换"><a href="#简单类型的转换" class="headerlink" title="简单类型的转换"></a>简单类型的转换</h3><h4 id="转为字符串"><a href="#转为字符串" class="headerlink" title="转为字符串"></a>转为字符串</h4><p>转字符串主要方法是：String(value)，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(<span class="number">123</span>)                   <span class="comment">// '123'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="number">-12.3</span>)                 <span class="comment">// '-12.3'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">null</span>)                  <span class="comment">// 'null'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">undefined</span>)             <span class="comment">// 'undefined'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">true</span>)                  <span class="comment">// 'true'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="literal">false</span>)                 <span class="comment">// 'false'</span></span><br><span class="line"><span class="built_in">String</span>(<span class="built_in">Symbol</span>(<span class="string">'mySymbol'</span>))<span class="comment">// 'Symbol(mySymbol)'</span></span><br></pre></td></tr></table></figure><p>简单类型转为字符串，基本是看到什么就转为什么。</p><h4 id="转为布尔值"><a href="#转为布尔值" class="headerlink" title="转为布尔值"></a>转为布尔值</h4><p>转布尔值的主要方法是：Boolean(value)，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Boolean</span>(<span class="string">''</span>)           <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">0</span>)            <span class="comment">// false     </span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="number">-0</span>)           <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">NaN</span>)          <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">null</span>)         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">undefined</span>)    <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Boolean</span>(<span class="literal">false</span>)        <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>除了上面的布尔值转换，其他任何简单类型(其实也包括复杂类型)的布尔值转换都为true。</p><h4 id="转为数字"><a href="#转为数字" class="headerlink" title="转为数字"></a>转为数字</h4><p>转为数字类型的主要方法是：Number(value), 如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="literal">null</span>)                   <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">undefined</span>)              <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">true</span>)                   <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">false</span>)                  <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">" 12 "</span>)                 <span class="comment">// 12</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">"-12.34"</span>)               <span class="comment">// -12.34</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">"\n"</span>)                   <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">" 12s "</span>)                <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="number">123</span>)                    <span class="comment">// 123</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="built_in">Symbol</span>(<span class="string">'my symbol'</span>))   <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure><p>基本规则：</p><table><thead><tr><th>Value</th><th>Becomes</th></tr></thead><tbody><tr><td>undefined</td><td>NaN</td></tr><tr><td>null</td><td>0</td></tr><tr><td>true/false</td><td>1/0</td></tr><tr><td>string</td><td>去掉开头和结尾的空格后，如果字符串为空，转换为0，否则，用Number()转换剩下的字符</td></tr></tbody></table><p>注意：Symbol类型不能转为数字，所以Symbol类型除了做加法，其他任何运算都会报错。做加法时，Symbol会被转换为字符串。另外转数字的方法还有：+value，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+<span class="string">'3'</span><span class="comment">// 3</span></span><br><span class="line">+<span class="string">'a'</span><span class="comment">// NaN</span></span><br><span class="line">+<span class="literal">true</span><span class="comment">// 1</span></span><br><span class="line">+<span class="keyword">new</span> <span class="built_in">Date</span>() <span class="comment">// timestamp 等价于Date.now()</span></span><br></pre></td></tr></table></figure><h3 id="复杂类型的转换"><a href="#复杂类型的转换" class="headerlink" title="复杂类型的转换"></a>复杂类型的转换</h3><h4 id="转为布尔值-1"><a href="#转为布尔值-1" class="headerlink" title="转为布尔值"></a>转为布尔值</h4><p>任何复杂类型，包括空对象空数组，全部转为true。</p><h4 id="转为字符串或数字"><a href="#转为字符串或数字" class="headerlink" title="转为字符串或数字"></a>转为字符串或数字</h4><p>转为字符串和数字，则是由 Symbol.toPrimitive 函数决定，此函数接收一个参数hint，必须返回简单数据类型的值，具体规则如下：</p><ol><li>如果存在的话，调用obj<a href="hint">Symbol.toPrimitive</a>。如果toPrimitive返回的不是简单类型，则抛出TypeError。</li><li>如果不存在，则根据hint，如果hint是string类型，则调用obj.toString()，如果toString()返回的是简单类型，则返回此结果并结束；如果toString()返回的不是简单类型，则调用obj.valueOf(), 如果valueOf()返回的是简单类型，则返回此结果并结束；如果valueOf()返回的不是简单类型，则抛出TypeError。如果hint是number，则跟string想反，先调用valueOf(),然后尝试toString()</li></ol><p>如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// toPrimitive返回复杂类型</span></span><br><span class="line">user = &#123;</span><br><span class="line">  name: <span class="string">"John"</span>,</span><br><span class="line">  money: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`User &#123;name: <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>, money: <span class="subst">$&#123;<span class="keyword">this</span>.money&#125;</span>&#125;`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  valueOf() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hint：%s'</span>, hint);</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;; <span class="comment">// 返回复杂类型</span></span><br><span class="line">    <span class="comment">//return hint == "string" ? `User &#123;name: "$&#123;this.name&#125;"&#125;` : this.money;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(user); <span class="comment">//输出hint为string后，抛出TypeError，因为toPrimitive返回的不是简单类型</span></span><br><span class="line"><span class="built_in">console</span>.log(user);</span><br><span class="line"><span class="built_in">console</span>.log(+user);</span><br><span class="line"><span class="built_in">console</span>.log(user+<span class="number">500</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(user));</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// toPrimitive根据hint类型返回简单类型</span></span><br><span class="line">user = &#123;</span><br><span class="line">  name: <span class="string">"John"</span>,</span><br><span class="line">  money: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`User &#123;name: <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>, money: <span class="subst">$&#123;<span class="keyword">this</span>.money&#125;</span>&#125;`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  valueOf() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hint：%s'</span>, hint);</span><br><span class="line">    <span class="keyword">return</span> hint == <span class="string">"string"</span> ? <span class="string">`User &#123;name: "<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>"&#125;`</span> : <span class="keyword">this</span>.money;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(user);<span class="comment">// hint输出为string，所以alert输出：User &#123;name: "John"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(user);<span class="comment">// <span class="doctag">TODO:</span>///既没调用toPrimitive,也没调用toString，此处未知log函数内部如何转换user</span></span><br><span class="line"><span class="built_in">console</span>.log(+user);<span class="comment">//1000 hint输出为number，所以返回this.money</span></span><br><span class="line"><span class="built_in">console</span>.log(user+<span class="number">500</span>); <span class="comment">//1500 hint输出为default， 所以返回this.money</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不存在toPrimitive，且valueOf返回复杂类型，toString返回简单类型</span></span><br><span class="line">user = &#123;</span><br><span class="line">  name: <span class="string">"John"</span>,</span><br><span class="line">  money: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`User &#123;name: <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>, money: <span class="subst">$&#123;<span class="keyword">this</span>.money&#125;</span>&#125;`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  valueOf() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(user); <span class="comment">// 直接调用toString返回</span></span><br><span class="line"><span class="built_in">console</span>.log(user); <span class="comment">//</span></span><br><span class="line"><span class="built_in">console</span>.log(+user);<span class="comment">// 先调用valueOf，然后调用toString，然后再转为数字，结果为NaN</span></span><br><span class="line"><span class="built_in">console</span>.log(user+<span class="number">500</span>); <span class="comment">// 先调用toString，然后再与500相连。</span></span><br></pre></td></tr></table></figure><h2 id="最佳实践建议"><a href="#最佳实践建议" class="headerlink" title="最佳实践建议"></a>最佳实践建议</h2><ol><li>运算前请显示转换类型，运算时最好不要让JS自己隐式转换。</li><li>如果显示转换还是不保险，那就先判断类型，再根据情况运算。如何判断类型？？？？:elephant:</li></ol><h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""</span> + <span class="number">1</span> + <span class="number">0</span> = <span class="string">"10"</span></span><br><span class="line"><span class="string">""</span> - <span class="number">1</span> + <span class="number">0</span> = <span class="number">-1</span></span><br><span class="line"><span class="literal">true</span> + <span class="literal">false</span> = <span class="number">1</span></span><br><span class="line"><span class="number">6</span> / <span class="string">"3"</span> = <span class="number">2</span></span><br><span class="line"><span class="string">"2"</span> * <span class="string">"3"</span> = <span class="number">6</span></span><br><span class="line"><span class="number">4</span> + <span class="number">5</span> + <span class="string">"px"</span> = <span class="string">"9px"</span></span><br><span class="line"><span class="string">"$"</span> + <span class="number">4</span> + <span class="number">5</span> = <span class="string">"$45"</span></span><br><span class="line"><span class="string">"4"</span> - <span class="number">2</span> = <span class="number">2</span></span><br><span class="line"><span class="string">"4px"</span> - <span class="number">2</span> = <span class="literal">NaN</span></span><br><span class="line"><span class="number">7</span> / <span class="number">0</span> = <span class="literal">Infinity</span></span><br><span class="line"><span class="string">" -9  "</span> + <span class="number">5</span> = <span class="string">" -9  5"</span></span><br><span class="line"><span class="string">" -9  "</span> - <span class="number">5</span> = <span class="number">-14</span></span><br><span class="line"><span class="literal">null</span> + <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"><span class="literal">undefined</span> + <span class="number">1</span> = <span class="literal">NaN</span></span><br><span class="line"><span class="string">" \t \n"</span> - <span class="number">2</span> = <span class="number">-2</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> &gt; <span class="number">4</span></span><br><span class="line"><span class="string">"apple"</span> &gt; <span class="string">"pineapple"</span></span><br><span class="line"><span class="string">"2"</span> &gt; <span class="string">"12"</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span></span><br><span class="line"><span class="literal">undefined</span> === <span class="literal">null</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">"\n0\n"</span></span><br><span class="line"><span class="literal">null</span> === +<span class="string">"\n0\n"</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>] &gt; <span class="literal">null</span></span><br><span class="line"><span class="string">"foo"</span> + + <span class="string">"bar"</span></span><br><span class="line"><span class="string">'true'</span> == <span class="literal">true</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">'false'</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">''</span></span><br><span class="line">!!<span class="string">"false"</span> == !!<span class="string">"true"</span></span><br><span class="line">[‘x’] == ‘x’</span><br><span class="line">[] + <span class="literal">null</span> + <span class="number">1</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#123;&#125;+[]+&#123;&#125;+[<span class="number">1</span>]</span><br><span class="line">!+[]+[]+![]</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) - <span class="number">0</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) + <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""</span> + <span class="number">1</span> + <span class="number">0</span> = <span class="string">"10"</span> <span class="comment">// 只要有一个字符串，加号另一边也转为字符串</span></span><br><span class="line"><span class="string">""</span> - <span class="number">1</span> + <span class="number">0</span> = <span class="number">-1</span> <span class="comment">// 减号两边会分别转为数字</span></span><br><span class="line"><span class="literal">true</span> + <span class="literal">false</span> = <span class="number">1</span><span class="comment">// 非字符串相加，则都转为数字</span></span><br><span class="line"><span class="number">6</span> / <span class="string">"3"</span> = <span class="number">2</span><span class="comment">// 除法两边转为数字</span></span><br><span class="line"><span class="string">"2"</span> * <span class="string">"3"</span> = <span class="number">6</span><span class="comment">// 乘法同除法</span></span><br><span class="line"><span class="number">4</span> + <span class="number">5</span> + <span class="string">"px"</span> = <span class="string">"9px"</span><span class="comment">// 先算数字加法得9，然后再连接字符串</span></span><br><span class="line"><span class="string">"$"</span> + <span class="number">4</span> + <span class="number">5</span> = <span class="string">"$45"</span><span class="comment">// 先连接前两个操作数，然后用前面的结果连接第三个</span></span><br><span class="line"><span class="string">"4"</span> - <span class="number">2</span> = <span class="number">2</span><span class="comment">// 减号两边转数字</span></span><br><span class="line"><span class="string">"4px"</span> - <span class="number">2</span> = <span class="literal">NaN</span><span class="comment">// 先分别转数字，‘4px’转数字后为NaN</span></span><br><span class="line"><span class="number">7</span> / <span class="number">0</span> = <span class="literal">Infinity</span><span class="comment">// 除零得无穷大</span></span><br><span class="line"><span class="string">" -9  "</span> + <span class="number">5</span> = <span class="string">" -9  5"</span> <span class="comment">// 只要有一个字符串，加号另一边也转为字符串</span></span><br><span class="line"><span class="string">" -9  "</span> - <span class="number">5</span> = <span class="number">-14</span> <span class="comment">// 先转数字，第一个操作数转为-9</span></span><br><span class="line"><span class="literal">null</span> + <span class="number">1</span> = <span class="number">1</span> <span class="comment">// 先转数字，null转数字后为0</span></span><br><span class="line"><span class="literal">undefined</span> + <span class="number">1</span> = <span class="literal">NaN</span> <span class="comment">// 先转数字，undefined转数字后为NaN</span></span><br><span class="line"><span class="string">" \t \n"</span> - <span class="number">2</span> = <span class="number">-2</span> <span class="comment">// 先转数字，第一个操作数转数字后为0</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> &gt; <span class="number">4</span><span class="comment">// true 不转换</span></span><br><span class="line"><span class="string">"apple"</span> &gt; <span class="string">"pineapple"</span>  <span class="comment">// false 不转换</span></span><br><span class="line"><span class="string">"2"</span> &gt; <span class="string">"12"</span> <span class="comment">// true 不转换</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span>  <span class="comment">// true null只与undefined或自身相等(==)</span></span><br><span class="line"><span class="literal">undefined</span> === <span class="literal">null</span>  <span class="comment">// false 不同类型</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">"\n0\n"</span>  <span class="comment">// false null只与undefined自身相等(==)</span></span><br><span class="line"><span class="literal">null</span> === +<span class="string">"\n0\n"</span>  <span class="comment">// false 类型不同</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 两边先分别转数字，数组属于复杂类型，所以先判断是否有toPrimitive。</span></span><br><span class="line"><span class="comment"> * 数组对象并不存在Symbol.toPrimitive方法，所以调用valueOf方法，但数组的valueOf方法返回的是其本身，</span></span><br><span class="line"><span class="comment"> * 即，非简单类型，所以继续调用toString，所以返回的是字符串'1', 继而转为数字1，而null转为数字0</span></span><br><span class="line"><span class="comment"> * 所以结果是true</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">[<span class="number">1</span>] &gt; <span class="literal">null</span><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 先算一元运算+'bar'，得到NaN，所以结果是foo与NaN相连得到'fooNaN'</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="string">"foo"</span> + + <span class="string">"bar"</span> <span class="comment">// 'fooNaN'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 先两边转数字，得到 NaN和1，所以结果为false</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="string">'true'</span> == <span class="literal">true</span>  <span class="comment">// false</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">'false'</span> <span class="comment">// 同上</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">''</span><span class="comment">// false null只等于undefined或自身</span></span><br><span class="line">!!<span class="string">"false"</span> == !!<span class="string">"true"</span> <span class="comment">// 先分别转为boolean值，然后再比较，非空字符串转布尔值为true，所以两边都是true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 参考第一个，数组最终会转为'x',而另一边也是'x',所以是字符串比较，无需再转换，即'x'=='x'</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[‘x’] == ‘x’     <span class="comment">//true </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* []+null+1 =&gt; ''+null+1 =&gt; 'null'+1 =&gt; 'null1'</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[] + <span class="literal">null</span> + <span class="number">1</span> <span class="comment">// null1</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] <span class="comment">// false 引用的内存地址不同</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* &#123;&#125;+[]+&#123;&#125;+[1]</span></span><br><span class="line"><span class="comment">* =&gt; +[]+&#123;&#125;+[1]  //第一个&#123;&#125;被当成了块语句，所以直接忽略,正在计算是从+[]开始</span></span><br><span class="line"><span class="comment">* =&gt; 0+&#123;&#125;+[1]    //+[]被转为数字0</span></span><br><span class="line"><span class="comment">* =&gt; 0+'[object Object]'+[1]  //&#123;&#125; 先调用valueOf，发现返回本身，再调用toString，所以返回[object Object]</span></span><br><span class="line"><span class="comment">* =&gt; '0[object Object]'+[1]</span></span><br><span class="line"><span class="comment">* =&gt; '0[object Object]1'      // [1] 先调用valueOf，返回本身，再调用toString，返回1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#123;&#125;+[]+&#123;&#125;+[<span class="number">1</span>] <span class="comment">// '0[object Object]1'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据优先级拆分为 (!+[])+[]+(![])</span></span><br><span class="line"><span class="comment">* =&gt; !0+[]+false</span></span><br><span class="line"><span class="comment">* =&gt; true+[]+false</span></span><br><span class="line"><span class="comment">* =&gt; true+''+false</span></span><br><span class="line"><span class="comment">* =&gt; 'truefalse'</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">!+[]+[]+![] <span class="comment">//'truefalse'</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) - <span class="number">0</span>  <span class="comment">// 0 调用Date的valueOf转为数字，valueOf返回的是0</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>) + <span class="number">0</span>  <span class="comment">// Thu Jan 01 1970 02:00:00 GMT+0200 (EET)0 调用Date的toString方法转为字符串再加0</span></span><br></pre></td></tr></table></figure><h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ol><li><a href="http://javascript.info/type-conversions" target="_blank" rel="noopener">http://javascript.info/type-conversions</a> </li><li><a href="http://javascript.info/comparison" target="_blank" rel="noopener">http://javascript.info/comparison</a> </li><li><a href="http://javascript.info/object-toprimitive" target="_blank" rel="noopener">http://javascript.info/object-toprimitive</a> </li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive</a> </li><li><a href="https://www.freecodecamp.org/news/js-type-coercion-explained-27ba3d9a2839/" target="_blank" rel="noopener">https://www.freecodecamp.org/news/js-type-coercion-explained-27ba3d9a2839/</a> </li><li><a href="https://2ality.com/2013/04/quirk-implicit-conversion.html" target="_blank" rel="noopener">https://2ality.com/2013/04/quirk-implicit-conversion.html</a> </li><li><a href="https://wtfjs.com/" target="_blank" rel="noopener">https://wtfjs.com/</a> </li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JS的类型一般有String，Number，Boolean，Symbol，null，undefined，Object这几种，其中前四种可以认为是简单类型，Object是复杂类型（包括Array，Date等），中间两种自成一体。&lt;/p&gt;
&lt;p&gt;我们都知道JS是弱类型的语言，所以难免会进行类型转换，而转换又有显式和隐式之分。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; == &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;			&lt;span class=&quot;comment&quot;&gt;// false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; / &lt;span class=&quot;string&quot;&gt;&#39;5&#39;&lt;/span&gt;				&lt;span class=&quot;comment&quot;&gt;// 0.4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Number&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;3&#39;&lt;/span&gt;)			&lt;span class=&quot;comment&quot;&gt;// 3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; === &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;			&lt;span class=&quot;comment&quot;&gt;// false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;第一，二行会进行隐式转换，第三行是显式转换，而第四行不会转换类型。这里先讨论隐式转换，无论是简单类型还是复杂类型，隐式转为最后都会转为boolean，string或者number中的一种。&lt;/p&gt;
&lt;h2 id=&quot;什么时候会进行隐式转换，又会转为什么类型&quot;&gt;&lt;a href=&quot;#什么时候会进行隐式转换，又会转为什么类型&quot; class=&quot;headerlink&quot; title=&quot;什么时候会进行隐式转换，又会转为什么类型&quot;&gt;&lt;/a&gt;什么时候会进行隐式转换，又会转为什么类型&lt;/h2&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="code" scheme="https://ywxgod.github.io/blog/tags/code/"/>
    
  </entry>
  
  <entry>
    <title>002 - 比较操作注意点</title>
    <link href="https://ywxgod.github.io/blog/2019/10/15/jsinfo/comparions/"/>
    <id>https://ywxgod.github.io/blog/2019/10/15/jsinfo/comparions/</id>
    <published>2019-10-14T17:25:18.554Z</published>
    <updated>2019-10-14T17:32:38.797Z</updated>
    
    <content type="html"><![CDATA[<p>记录自己比较容易忘记的概念和内容，方便以后查阅。原文请参考： <a href="http://javascript.info/comparison" target="_blank" rel="noopener">http://javascript.info/comparison</a> </p><p>比较操作包括：&gt;，&lt;，&gt;=，&lt;=，==，===，!=，!==</p><h3 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h3><p>字符串的比较是将每个字符分别比较，而比较字符的时候用的是字典顺序，准确的说应该是每个字符的unicode的编码顺序。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">'a'</span>&lt;<span class="string">'b'</span>); <span class="comment">// true</span></span><br><span class="line">alert(<span class="string">'apple'</span>&lt;<span class="string">'bus'</span>); <span class="comment">//true</span></span><br><span class="line">alert(<span class="string">'who'</span>&lt;<span class="string">'whois'</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="两个字符串比较算法："><a href="#两个字符串比较算法：" class="headerlink" title="两个字符串比较算法："></a>两个字符串比较算法：</h3><ol><li><p>Compare the first character of both strings.<br>比较两者的第一个字符</p></li><li><p>If the first character from the first string is greater (or less) than the other string’s, then the first string is greater (or less) than the second. We’re done.<br>如果前者的第一个字符大于(或小于)后者的第一个字符，则前者大于(或小于)后者。结束比较。</p></li><li><p>Otherwise, if both strings’ first characters are the same, compare the second characters the same way.<br>否则，如果他们的第一个字符相同，那么分别取第二个字符进行比较</p></li><li><p>Repeat until the end of either string.<br>重复上面的操作，直到一个字符串结束。</p></li><li><p>If both strings end at the same length, then they are equal. Otherwise, the longer string is greater.<br>如果两个字符串长度相同，那么两者相等。否则，长度较长的字符串大。</p></li></ol><h3 id="不同类型数据比较"><a href="#不同类型数据比较" class="headerlink" title="不同类型数据比较"></a>不同类型数据比较</h3><p>当比较操作两边的数据不同类型时，操作数都会转为数字类型，然后进行比较。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'2'</span>&gt;<span class="number">1</span>); <span class="comment">// true '2'被转为数字2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'01'</span>==<span class="number">1</span>); <span class="comment">// true '01'被转为数字1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">true</span>==<span class="number">1</span>); <span class="comment">// true true被转为数字1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">false</span>==<span class="string">'0'</span>); <span class="comment">//true false被转为0，‘0’被转0</span></span><br></pre></td></tr></table></figure><h3 id="与"><a href="#与" class="headerlink" title="== 与 ==="></a>== 与 ===</h3><p>== 比较时会将操作数进行类型转换，而===不会转换操作数的类型，对于===只有类型不同即不相等。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert( <span class="number">0</span> === <span class="literal">false</span> ); <span class="comment">// false 类型不同</span></span><br><span class="line">alert( <span class="number">0</span> == <span class="literal">false</span> ); <span class="comment">// true false会被转为数字0</span></span><br></pre></td></tr></table></figure><h3 id="null与undefined的比较"><a href="#null与undefined的比较" class="headerlink" title="null与undefined的比较"></a>null与undefined的比较</h3><ol><li>避免用null，undefined去跟其他数据类型进行比较，特别是用全等比较，切记避免。</li><li>对于全等比较，null不等于undefined，因为类型不同。</li><li>对于非全等比较，null只等于undefined，或者undefined只等于null，它俩互相相等，而不和其他任何数相等。<br>There’s a special rule. These two are a “sweet couple”: they equal each other (in the sense of <code>==</code>), but not any other value. </li><li>null转为数字是0，undefined转为数字是NaN</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alert( <span class="literal">null</span> &gt; <span class="number">0</span> );  <span class="comment">// (1) false</span></span><br><span class="line">alert( <span class="literal">null</span> == <span class="number">0</span> ); <span class="comment">// (2) false</span></span><br><span class="line">alert( <span class="literal">null</span> &gt;= <span class="number">0</span> ); <span class="comment">// (3) true</span></span><br><span class="line">alert( <span class="literal">undefined</span> &gt; <span class="number">0</span> ); <span class="comment">// (4) false</span></span><br><span class="line">alert( <span class="literal">undefined</span> &lt; <span class="number">0</span> ); <span class="comment">// (5) false</span></span><br><span class="line">alert( <span class="literal">undefined</span> == <span class="number">0</span> ); <span class="comment">// (6) false</span></span><br></pre></td></tr></table></figure><p>(1) - null被转为数字0，所以null&gt;0为false<br>(2) - 用非全等比较时，null只与undefined相等，不与其他任何数相等。<br>(3) - null被转为数字0，所以null&gt;=0为true<br>(4) - undefined被转为NaN，所以NaN&gt;0为false，NaN与任何数比较都返回false。<br>(5) - 同(4)<br>(6) - 用非全等比较时，undefined只与null相等，不与其他任何数相等。</p><p>以上这些奇怪的比较行为，我们在写代码过程中应该尽量避免。特别是对null和undefined的比较要特别注意。</p><h2 id="习题："><a href="#习题：" class="headerlink" title="习题："></a>习题：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span> &gt; <span class="number">4</span></span><br><span class="line"><span class="string">"apple"</span> &gt; <span class="string">"pineapple"</span></span><br><span class="line"><span class="string">"2"</span> &gt; <span class="string">"12"</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span></span><br><span class="line"><span class="literal">undefined</span> === <span class="literal">null</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">"\n0\n"</span></span><br><span class="line"><span class="literal">null</span> === +<span class="string">"\n0\n"</span></span><br></pre></td></tr></table></figure><h2 id="答案："><a href="#答案：" class="headerlink" title="答案："></a>答案：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span> &gt; <span class="number">4</span> → <span class="literal">true</span></span><br><span class="line"><span class="string">"apple"</span> &gt; <span class="string">"pineapple"</span> → <span class="literal">false</span></span><br><span class="line"><span class="string">"2"</span> &gt; <span class="string">"12"</span> → <span class="literal">true</span></span><br><span class="line"><span class="literal">undefined</span> == <span class="literal">null</span> → <span class="literal">true</span></span><br><span class="line"><span class="literal">undefined</span> === <span class="literal">null</span> → <span class="literal">false</span></span><br><span class="line"><span class="literal">null</span> == <span class="string">"\n0\n"</span> → <span class="literal">false</span></span><br><span class="line"><span class="literal">null</span> === +<span class="string">"\n0\n"</span> → <span class="literal">false</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录自己比较容易忘记的概念和内容，方便以后查阅。原文请参考： &lt;a href=&quot;http://javascript.info/comparison&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://javascript.info/comparison&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;比较操作包括：&amp;gt;，&amp;lt;，&amp;gt;=，&amp;lt;=，==，===，!=，!==&lt;/p&gt;
&lt;h3 id=&quot;字符串比较&quot;&gt;&lt;a href=&quot;#字符串比较&quot; class=&quot;headerlink&quot; title=&quot;字符串比较&quot;&gt;&lt;/a&gt;字符串比较&lt;/h3&gt;&lt;p&gt;字符串的比较是将每个字符分别比较，而比较字符的时候用的是字典顺序，准确的说应该是每个字符的unicode的编码顺序。如：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;string&quot;&gt;&#39;a&#39;&lt;/span&gt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&#39;b&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;string&quot;&gt;&#39;apple&#39;&lt;/span&gt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&#39;bus&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;string&quot;&gt;&#39;who&#39;&lt;/span&gt;&amp;lt;&lt;span class=&quot;string&quot;&gt;&#39;whois&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="JS操作符" scheme="https://ywxgod.github.io/blog/tags/JS%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
    
  </entry>
  
  <entry>
    <title>mongoose如何清除collections</title>
    <link href="https://ywxgod.github.io/blog/2019/10/14/mongoose/drop_collections/"/>
    <id>https://ywxgod.github.io/blog/2019/10/14/mongoose/drop_collections/</id>
    <published>2019-10-14T15:32:49.969Z</published>
    <updated>2019-10-14T15:40:53.953Z</updated>
    
    <content type="html"><![CDATA[<p>服务器启动时，初始化了一些静态数据，当服务器退出时可能需要清掉这些数据，所以看看如何清除MongoDB的collections。</p><h2 id="清除collections的几种方法："><a href="#清除collections的几种方法：" class="headerlink" title="清除collections的几种方法："></a>清除collections的几种方法：</h2><ol><li><h3 id="通过connection-collections，如："><a href="#通过connection-collections，如：" class="headerlink" title="通过connection.collections，如："></a>通过connection.collections，如：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> collectionName = <span class="string">'users'</span>;</span><br><span class="line"><span class="keyword">this</span>.connection.collections[collectionName].drop() <span class="comment">//drop方法清除名称为users的collection</span></span><br></pre></td></tr></table></figure></li></ol><a id="more"></a>    <ol start="2"><li><h3 id="通过connection-dropCollection方法，如："><a href="#通过connection-dropCollection方法，如：" class="headerlink" title="通过connection.dropCollection方法，如："></a>通过connection.dropCollection方法，如：</h3> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 通过调用dropCollection方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> collectionName = <span class="string">'users'</span>;</span><br><span class="line"><span class="keyword">this</span>.connection.dropCollection(collectionName).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res); <span class="comment">//true</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//res 为true表示删除成功</span></span><br></pre></td></tr></table></figure></li><li><h3 id="通过Model-collection，-如："><a href="#通过Model-collection，-如：" class="headerlink" title="通过Model.collection， 如："></a>通过Model.collection， 如：</h3> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> collectionName = <span class="string">'user'</span>;</span><br><span class="line"><span class="keyword">let</span> UserSchema = <span class="keyword">new</span> mongoose.Schema(&#123;&#125;);</span><br><span class="line"><span class="keyword">let</span> UserModel = <span class="keyword">this</span>.connection.model(collectionName, UserSchema);</span><br><span class="line">UserModel.collections.drop(); <span class="comment">//删除collections</span></span><br></pre></td></tr></table></figure></li></ol><p>假如我们要在nodejs进程退出之前清除数据库里的临时数据，可以像下面这样：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearUsers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> collectionName = <span class="string">'users'</span>;</span><br><span class="line">    <span class="keyword">this</span>.connection.dropCollection(collectionName).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res); <span class="comment">//true</span></span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'SIGINT'</span>, () =&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//退出前清除初始化数据</span></span><br><span class="line">    <span class="keyword">this</span>.clearUsers();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//连接关闭时的事件</span></span><br><span class="line">    <span class="keyword">this</span>.connection.close( <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果在此处调用将无效，因为数据库连接已经断开。</span></span><br><span class="line">        <span class="comment">// this.clearUsers(); </span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Mongoose disconnected through app termination'</span>);</span><br><span class="line">        process.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;服务器启动时，初始化了一些静态数据，当服务器退出时可能需要清掉这些数据，所以看看如何清除MongoDB的collections。&lt;/p&gt;
&lt;h2 id=&quot;清除collections的几种方法：&quot;&gt;&lt;a href=&quot;#清除collections的几种方法：&quot; class=&quot;headerlink&quot; title=&quot;清除collections的几种方法：&quot;&gt;&lt;/a&gt;清除collections的几种方法：&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;h3 id=&quot;通过connection-collections，如：&quot;&gt;&lt;a href=&quot;#通过connection-collections，如：&quot; class=&quot;headerlink&quot; title=&quot;通过connection.collections，如：&quot;&gt;&lt;/a&gt;通过connection.collections，如：&lt;/h3&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; collectionName = &lt;span class=&quot;string&quot;&gt;&#39;users&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.connection.collections[collectionName].drop() &lt;span class=&quot;comment&quot;&gt;//drop方法清除名称为users的collection&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="mongoose" scheme="https://ywxgod.github.io/blog/tags/mongoose/"/>
    
  </entry>
  
  <entry>
    <title>001 - JS操作符注意点</title>
    <link href="https://ywxgod.github.io/blog/2019/10/13/jsinfo/operators/"/>
    <id>https://ywxgod.github.io/blog/2019/10/13/jsinfo/operators/</id>
    <published>2019-10-13T03:59:19.489Z</published>
    <updated>2019-10-13T04:34:45.045Z</updated>
    
    <content type="html"><![CDATA[<p>记录自己比较容易忘记的概念和内容，方便以后查阅。原文请参考：<a href="http://javascript.info/operators" target="_blank" rel="noopener">http://javascript.info/operators</a></p><h3 id="二元运算符"><a href="#二元运算符" class="headerlink" title="二元运算符(+/-*)"></a>二元运算符(+/-*)</h3><p>对于 + 运算符，只要有一个操作数是字符串，将会另外一个也转为字符串，如：<br>The rule is simple: if either operand is a string, the other one is converted into a string as well </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">'my'</span>+<span class="string">'string'</span>;</span><br><span class="line">alert(s); <span class="comment">// mystring</span></span><br><span class="line">alert(<span class="string">'1'</span>+<span class="number">2</span>); <span class="comment">//'12'</span></span><br><span class="line">alert(<span class="number">2</span>+<span class="string">'1'</span>); <span class="comment">//'21'</span></span><br><span class="line">alert(<span class="number">2</span>+<span class="number">2</span>+<span class="string">'1'</span>); <span class="comment">//'41' and not '221'</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>其他运算符(/-*)只会对数字进行运算，所以它们会先将非数字的操作数转为数字，然后再运算，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="number">2</span>-<span class="string">'1'</span>); <span class="comment">//1</span></span><br><span class="line">alert(<span class="string">'2'</span>-<span class="string">'1'</span>); <span class="comment">//1</span></span><br><span class="line">alert(<span class="string">'3'</span><span class="number">-1</span>); <span class="comment">//2</span></span><br><span class="line">alert(<span class="string">'5'</span>/<span class="number">2</span>); <span class="comment">//2.5</span></span><br><span class="line">alert(<span class="string">'3'</span>*<span class="number">3</span>); <span class="comment">//9</span></span><br></pre></td></tr></table></figure><h3 id="一元运算符"><a href="#一元运算符" class="headerlink" title="一元运算符(+)"></a>一元运算符(+)</h3><p>对于一元运算符 + ，当操作数为数字时，不会操作数字。当不是数字时，将会转为数字，相当于Number(…)，如：<br>The unary plus or, in other words, the plus operator <code>+</code> applied to a single value, doesn’t do anything to numbers. But if the operand is not a number, the unary plus converts it into a number. </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line">alert(+<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">-2</span>;</span><br><span class="line">alert(+y); <span class="comment">// -2</span></span><br><span class="line">alert(+<span class="literal">true</span>); <span class="comment">// 1</span></span><br><span class="line">alert(+<span class="string">''</span>); <span class="comment">// 0</span></span><br><span class="line">alert(+<span class="string">'3'</span>++<span class="string">'4'</span>); <span class="comment">// Uncaught SyntaxError: Invalid left-hand side expression in postfix operation</span></span><br><span class="line">alert(+<span class="string">'3'</span>+ +<span class="string">'4'</span>); <span class="comment">// 7 一元运算符优先级高于二元运算符</span></span><br></pre></td></tr></table></figure><h3 id="赋值操作符"><a href="#赋值操作符" class="headerlink" title="赋值操作符(=)"></a>赋值操作符(=)</h3><p>赋值运算优先级低于二元运算。赋值运算可以链式执行，且会返回最左端变量的值，如：<br>The call x = value writes the value into x and then returns it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a, b, c, d;</span><br><span class="line">a = b = c = <span class="number">2</span>+<span class="number">2</span>;</span><br><span class="line">alert(a); <span class="comment">// 4</span></span><br><span class="line">alert(b); <span class="comment">// 4</span></span><br><span class="line">alert(c); <span class="comment">// 4</span></span><br><span class="line">alert(d = <span class="number">2</span>+<span class="number">5</span>); <span class="comment">//7 先将2+5的值赋值给d，然后返回d的值传给alert</span></span><br></pre></td></tr></table></figure><h3 id="求幂运算符"><a href="#求幂运算符" class="headerlink" title="求幂运算符(**)"></a>求幂运算符(**)</h3><p>求幂运算符是ES6新增的特性，a**b表示将a进行b次相乘，返回相乘后的结果。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="number">2</span>**<span class="number">3</span>); <span class="comment">// 8 2的3次方</span></span><br><span class="line">alert(<span class="number">4</span>**<span class="number">5</span>); <span class="comment">// 1024 4的5次方</span></span><br><span class="line">alert(<span class="number">8</span>**(<span class="number">1</span>/<span class="number">3</span>)); <span class="comment">// 2 8的1/3次方</span></span><br></pre></td></tr></table></figure><h3 id="逗号运算符"><a href="#逗号运算符" class="headerlink" title="逗号运算符( , )"></a>逗号运算符( , )</h3><p>逗号运算符最常见在被压缩后的js代码中。<br>逗号运算会从左到右计算每个表达式的值，最后返回最右边一个的值，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = (<span class="number">1</span>+<span class="number">2</span>, <span class="number">3</span>+<span class="number">4</span>); <span class="comment">//将a赋值给一个逗号表达式</span></span><br><span class="line">alert(a); <span class="comment">// 7 a取最右边的表达式的值</span></span><br></pre></td></tr></table></figure><p>逗号表达式的优先级很低，比赋值运算还要低，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>+<span class="number">2</span>, <span class="number">3</span>+<span class="number">4</span>;</span><br><span class="line">alert(a); <span class="comment">// 3 先运算1+2=3，再将3赋值给a，忽略3+4，再将a的值传给alert</span></span><br><span class="line"><span class="keyword">let</span> s = a=<span class="number">1</span>+<span class="number">2</span>,<span class="number">3</span>+<span class="number">4</span>;</span><br><span class="line">alert(s); <span class="comment">// 7 传给alert的值是逗号表达式(3,7)的返回值,所以相当于alert(7)</span></span><br></pre></td></tr></table></figure><h2 id="单词"><a href="#单词" class="headerlink" title="单词"></a>单词</h2><table><thead><tr><th>operand</th><th>n. [计] 操作数；[计] 运算对象</th></tr></thead><tbody><tr><td>operator</td><td>n. 操作符</td></tr><tr><td>unary</td><td>n. 一元操作符</td></tr><tr><td>binary</td><td>n. 二元操作符</td></tr><tr><td>terminology</td><td>n. 术语，术语学；用辞</td></tr><tr><td>operator precedence</td><td>英 /ˈpresɪdəns/ n. 运算符优先级</td></tr></tbody></table><h2 id="句子"><a href="#句子" class="headerlink" title="句子"></a>句子</h2><ol><li>Let’s grasp some common terminology.<br>让我们掌握一些常用术语。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录自己比较容易忘记的概念和内容，方便以后查阅。原文请参考：&lt;a href=&quot;http://javascript.info/operators&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://javascript.info/operators&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;二元运算符&quot;&gt;&lt;a href=&quot;#二元运算符&quot; class=&quot;headerlink&quot; title=&quot;二元运算符(+/-*)&quot;&gt;&lt;/a&gt;二元运算符(+/-*)&lt;/h3&gt;&lt;p&gt;对于 + 运算符，只要有一个操作数是字符串，将会另外一个也转为字符串，如：&lt;br&gt;The rule is simple: if either operand is a string, the other one is converted into a string as well &lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; s = &lt;span class=&quot;string&quot;&gt;&#39;my&#39;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;string&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(s); &lt;span class=&quot;comment&quot;&gt;// mystring&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;string&quot;&gt;&#39;1&#39;&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//&#39;12&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;1&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//&#39;21&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;alert(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;+&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;1&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//&#39;41&#39; and not &#39;221&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="JS操作符" scheme="https://ywxgod.github.io/blog/tags/JS%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
    
  </entry>
  
  <entry>
    <title>样式代码结构参考</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/css/style_categories/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/css/style_categories/</id>
    <published>2019-10-10T19:32:59.543Z</published>
    <updated>2019-08-29T01:28:12.397Z</updated>
    
    <content type="html"><![CDATA[<h3 id="结构参考"><a href="#结构参考" class="headerlink" title="结构参考"></a>结构参考</h3><ul><li>一般性样式<ol><li>主体样式</li><li>reset样式</li><li>链接</li><li>标题</li><li>其他元素</li></ol></li><li>辅助样式<ol><li>表单</li><li>通知和错误</li><li>一致的条目</li></ol></li><li>页面结构<ol><li>头部、页脚和导航</li><li>布局</li><li>其他页面结构元素</li></ol></li><li>页面组件<ol><li>各个页面模块</li></ol></li><li>覆盖<br>使用统一的大块注释分割每个部分如：<a id="more"></a><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* @group general styles</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @group helper styles</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @group page structure</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @group page modules</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @group overrides</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------- */</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="特殊性"><a href="#特殊性" class="headerlink" title="特殊性"></a>特殊性</h3><p>特殊性分4个等级：a,b,c,d.</p><ul><li>如果样式是行内样式，a=1.</li><li>b等于ID选择器的总数</li><li>c等于类，伪类和属性选择器的数量</li><li>d等于元素和伪元素的数量</li></ul><table><thead><tr><th style="text-align:left">选择器</th><th style="text-align:center">特殊性</th><th style="text-align:right">特殊值</th></tr></thead><tbody><tr><td style="text-align:left">Style=””</td><td style="text-align:center">1,0,0,0</td><td style="text-align:right">1000</td></tr><tr><td style="text-align:left">#wrapper #content {}</td><td style="text-align:center">0,2,0,0</td><td style="text-align:right">200</td></tr><tr><td style="text-align:left">#wrapper .date {}</td><td style="text-align:center">0,1,1,0</td><td style="text-align:right">110</td></tr><tr><td style="text-align:left">div#content {}</td><td style="text-align:center">0,1,0,1</td><td style="text-align:right">101</td></tr><tr><td style="text-align:left">#content {}</td><td style="text-align:center">0,1,0,0</td><td style="text-align:right">100</td></tr><tr><td style="text-align:left">p.content .date {}</td><td style="text-align:center">0,0,2,1</td><td style="text-align:right">21</td></tr><tr><td style="text-align:left">p.content {}</td><td style="text-align:center">0,0,1,1</td><td style="text-align:right">11</td></tr><tr><td style="text-align:left">p div {}</td><td style="text-align:center">0,0,0,2</td><td style="text-align:right">2</td></tr><tr><td style="text-align:left">p {}</td><td style="text-align:center">0,0,0,1</td><td style="text-align:right">1</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;结构参考&quot;&gt;&lt;a href=&quot;#结构参考&quot; class=&quot;headerlink&quot; title=&quot;结构参考&quot;&gt;&lt;/a&gt;结构参考&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;一般性样式&lt;ol&gt;
&lt;li&gt;主体样式&lt;/li&gt;
&lt;li&gt;reset样式&lt;/li&gt;
&lt;li&gt;链接&lt;/li&gt;
&lt;li&gt;标题&lt;/li&gt;
&lt;li&gt;其他元素&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;辅助样式&lt;ol&gt;
&lt;li&gt;表单&lt;/li&gt;
&lt;li&gt;通知和错误&lt;/li&gt;
&lt;li&gt;一致的条目&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;页面结构&lt;ol&gt;
&lt;li&gt;头部、页脚和导航&lt;/li&gt;
&lt;li&gt;布局&lt;/li&gt;
&lt;li&gt;其他页面结构元素&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;页面组件&lt;ol&gt;
&lt;li&gt;各个页面模块&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;覆盖&lt;br&gt;使用统一的大块注释分割每个部分如：
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="css" scheme="https://ywxgod.github.io/blog/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>mongoose链接数据库时的两个警告处理</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/mongoose/mongoose_issues/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/mongoose/mongoose_issues/</id>
    <published>2019-10-10T19:32:59.543Z</published>
    <updated>2019-09-26T18:10:04.658Z</updated>
    
    <content type="html"><![CDATA[<p>通过正常情况启动mongoose（mongoose版本为5.7.1，node.js版本为12.10.0）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uri = <span class="string">'mongodb://localhost:27017/blog_db'</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"><span class="keyword">async</span> connect()&#123;</span><br><span class="line">    <span class="keyword">let</span> connection = mongoose.createConnection();</span><br><span class="line"><span class="keyword">this</span>.addEvents(connection);</span><br><span class="line"><span class="keyword">return</span> connection.openUri(uri, options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> connection = <span class="keyword">await</span> connect();</span><br></pre></td></tr></table></figure><p>启动后控制台会出现以下警告：<a id="more"></a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(node:6248) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option &#123; useUnifiedTopology: true &#125; to the MongoClient constructor.</span><br><span class="line">Mongoose connected to mongodb://localhost:27017/blog_db</span><br><span class="line">(node:6248) DeprecationWarning: collection.ensureIndex is deprecated. Use createIndexes instead.</span><br></pre></td></tr></table></figure><p>根据提示，添加 useUnifiedTopology: true到连接选项，即可消除第一个警告</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,  <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><p>添加 useCreateIndex: true 消除第二个警告：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> options = &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,  <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>, <span class="attr">useCreateIndex</span>: <span class="literal">true</span>&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;通过正常情况启动mongoose（mongoose版本为5.7.1，node.js版本为12.10.0）&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; uri = &lt;span class=&quot;string&quot;&gt;&#39;mongodb://localhost:27017/blog_db&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; options = &amp;#123;&lt;span class=&quot;attr&quot;&gt;useNewUrlParser&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; connect()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; connection = mongoose.createConnection();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.addEvents(connection);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; connection.openUri(uri, options);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; connection = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; connect();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;启动后控制台会出现以下警告：
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="mongoose" scheme="https://ywxgod.github.io/blog/tags/mongoose/"/>
    
  </entry>
  
  <entry>
    <title>Canvas大小的设定</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_size_intro/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_size_intro/</id>
    <published>2019-10-10T19:32:59.528Z</published>
    <updated>2019-08-19T15:44:23.726Z</updated>
    
    <content type="html"><![CDATA[<p>通常设置canvas大小有两种方法:</p><ol><li>通过css设置width与height</li><li>通过canvas标签的属性width与height设置</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.canvas</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">width</span>=<span class="string">"300"</span> <span class="attr">height</span>=<span class="string">"150"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><p>两种方法的区别：<br><a id="more"></a></p><ol><li>通过css设置时值需要带上单位，如px；通过属性设置时不需要单位，只要一个非负整数。</li><li>通过css设置大小时，只设置了canvas元素(HTMLCanvasElement)的大小；通过属性设置时同时设置了canvas元素的大小和canvas绘图表面的大小。</li><li>当两种方法设置的大小不相同时，浏览器会将绘图表面大小缩放到canvas元素的大小。</li></ol><p>同样的绘制代码，设置canvas大小不同，效果不一样。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line"><span class="keyword">var</span> context = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">context.font = <span class="string">'20px sans-serif'</span>;</span><br><span class="line">context.textAlign = <span class="string">'start'</span>;</span><br><span class="line">context.textBaseline = <span class="string">'top'</span>;</span><br><span class="line">context.strokeStyle = <span class="string">'blue'</span>;</span><br><span class="line">context.strokeText(<span class="string">'What can I do for you?'</span>, <span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><img src="/blog/css/images/canvas_size_prop.png" alt="未通过css设置大小时的效果"></p><p><img src="/blog/css/images/canvas_size_css.png" alt="通过css设置大小，且与canvas属性设置的大小不一样时的效果"></p><p>第二图，canvas属性设置为(300,150),css设置为(600,300)。<br>所以绘图表面比元素小，此时浏览器将绘图表面拉伸到了canvas元素的大小，文本看上去被放大了。</p><p>由于上面的区别，所以鼠标在canvas上点击时，要获取鼠标相对于canvas左上角的坐标，需要考虑这个放大系数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canvas.onmousedown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> bbox = canvas.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">let</span> x = e.clientX - bbox.left*(canvas.width/bbox.width);</span><br><span class="line">    <span class="keyword">let</span> y = e.clientY - bbox.top*(canvas.height/bbox.height);</span><br><span class="line">    <span class="keyword">return</span> &#123;x,y&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;通常设置canvas大小有两种方法:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过css设置width与height&lt;/li&gt;
&lt;li&gt;通过canvas标签的属性width与height设置&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-class&quot;&gt;.canvas&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;width&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;600px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;height&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;300px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;canvas&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;300&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;150&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;canvas&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;两种方法的区别：&lt;br&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="canvas" scheme="https://ywxgod.github.io/blog/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>css基础知识</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/css/css_foundation/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/css/css_foundation/</id>
    <published>2019-10-10T19:32:59.528Z</published>
    <updated>2019-09-01T09:59:15.983Z</updated>
    
    <content type="html"><![CDATA[<h2 id="普通说明"><a href="#普通说明" class="headerlink" title="普通说明"></a>普通说明</h2><ul><li>普通文档流中的块框外边距会叠加，但行内块，浮动框，绝对定位的块是不会叠加的。</li><li>修改行内框的唯一方式是修改行高或者水平边框、外边距、内边距。</li><li>inline-block让元素按照行内框水平排列，但可以设置其宽度高端。</li><li>相对定位是相对于自身在文档流中的初始位置，绝对定位是相对于距离它最近的已定位祖先元素。</li><li>已定位元素是指position值为relative，absolute或者fixed。</li></ul><h2 id="背景图像效果"><a href="#背景图像效果" class="headerlink" title="背景图像效果"></a>背景图像效果</h2><h3 id="基本知识点"><a href="#基本知识点" class="headerlink" title="基本知识点"></a>基本知识点</h3><h4 id="默认情况，背景图像会被水平和垂直地重复显示。"><a href="#默认情况，背景图像会被水平和垂直地重复显示。" class="headerlink" title="默认情况，背景图像会被水平和垂直地重复显示。"></a>默认情况，背景图像会被水平和垂直地重复显示。</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(https://www.baidu.com/img/bd_logo1.png)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="背景垂直渐变"><a href="#背景垂直渐变" class="headerlink" title="背景垂直渐变"></a>背景垂直渐变</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">1. 可以创建一张1像素宽，最够长的图像在x方向重复平铺</span></span><br><span class="line"><span class="comment">2. 将背景色设置为渐变色的最后一个颜色</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(/img/gradient.gif); <span class="comment">/** width=1,height=1000 */</span></span><br><span class="line">    <span class="attribute">background-repeat</span>: repeat-x;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ccc</span>; <span class="comment">/** 图片上最后的渐变色 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="固定宽高图片的显示"><a href="#固定宽高图片的显示" class="headerlink" title="固定宽高图片的显示"></a>固定宽高图片的显示</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#branding</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">700px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(/img/branding.gif);</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="给指定元素增加图标"><a href="#给指定元素增加图标" class="headerlink" title="给指定元素增加图标"></a>给指定元素增加图标</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(/img/icon/doc.gif);</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="comment">/** 水平方向定位在左侧，垂直方向居中显示 */</span></span><br><span class="line">    <span class="attribute">background-position</span>: left center; </span><br><span class="line">    <span class="comment">/** 还可以用百分百实现上面一样的效果，两者用其一 */</span></span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0</span> <span class="number">50%</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>background-position用像素为单位时，相对于元素的左上角。用百分百时，是将相对于图像左上角百分百位置的点设置到相对于父元素左上角百分百位置的点上。</p><h2 id="对链接应用样式"><a href="#对链接应用样式" class="headerlink" title="对链接应用样式"></a>对链接应用样式</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>:link, :visited 需放置于:hover, :active, :focus之前，否则会被覆盖而不起作用。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * a:link 没有访问过的链接 </span></span><br><span class="line"><span class="comment"> * a:visited 访问过的链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * a:hover 悬停</span></span><br><span class="line"><span class="comment"> * a:focus tab移动，获取焦点</span></span><br><span class="line"><span class="comment"> * a:active 被激活的链接，激活发生在链接被点击时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:active</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="下划线自定义"><a href="#下划线自定义" class="headerlink" title="下划线自定义"></a>下划线自定义</h3><p>可以用下边框替代，进而可以使用边框背景图</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 用下边框替代下划线 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> dotted <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:active</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">border-bottom-style</span>: solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 用背景图替换下划线 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'https://www.baidu.com/img/baidu_jgylogo3.gif'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="给链接目标添加样式"><a href="#给链接目标添加样式" class="headerlink" title="给链接目标添加样式"></a>给链接目标添加样式</h3><p>链接目标是被锚点链接到的元素。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.target-element-selector</span><span class="selector-pseudo">:target</span>&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="区分不同类型的链接"><a href="#区分不同类型的链接" class="headerlink" title="区分不同类型的链接"></a>区分不同类型的链接</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 通过属性选择器查找链接到外部页面的链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href^='http:']</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 邮箱链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href^='mailto:']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 区分可下载的链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href$='.pdf']</span>,<span class="selector-tag">a</span><span class="selector-attr">[href$='.doc']</span>&#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="创建按钮"><a href="#创建按钮" class="headerlink" title="创建按钮"></a>创建按钮</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">6.6em</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#66a300</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#8cca12</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;普通说明&quot;&gt;&lt;a href=&quot;#普通说明&quot; class=&quot;headerlink&quot; title=&quot;普通说明&quot;&gt;&lt;/a&gt;普通说明&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;普通文档流中的块框外边距会叠加，但行内块，浮动框，绝对定位的块是不会叠加的。&lt;/li&gt;
&lt;li&gt;修改行内框的唯一方式是修改行高或者水平边框、外边距、内边距。&lt;/li&gt;
&lt;li&gt;inline-block让元素按照行内框水平排列，但可以设置其宽度高端。&lt;/li&gt;
&lt;li&gt;相对定位是相对于自身在文档流中的初始位置，绝对定位是相对于距离它最近的已定位祖先元素。&lt;/li&gt;
&lt;li&gt;已定位元素是指position值为relative，absolute或者fixed。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;背景图像效果&quot;&gt;&lt;a href=&quot;#背景图像效果&quot; class=&quot;headerlink&quot; title=&quot;背景图像效果&quot;&gt;&lt;/a&gt;背景图像效果&lt;/h2&gt;&lt;h3 id=&quot;基本知识点&quot;&gt;&lt;a href=&quot;#基本知识点&quot; class=&quot;headerlink&quot; title=&quot;基本知识点&quot;&gt;&lt;/a&gt;基本知识点&lt;/h3&gt;&lt;h4 id=&quot;默认情况，背景图像会被水平和垂直地重复显示。&quot;&gt;&lt;a href=&quot;#默认情况，背景图像会被水平和垂直地重复显示。&quot; class=&quot;headerlink&quot; title=&quot;默认情况，背景图像会被水平和垂直地重复显示。&quot;&gt;&lt;/a&gt;默认情况，背景图像会被水平和垂直地重复显示。&lt;/h4&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;body&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;background-image&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;url&lt;/span&gt;(https://www.baidu.com/img/bd_logo1.png)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="css" scheme="https://ywxgod.github.io/blog/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>Canvas中文本的定位</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_text_position/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_text_position/</id>
    <published>2019-10-10T19:32:59.528Z</published>
    <updated>2019-08-19T15:44:23.727Z</updated>
    
    <content type="html"><![CDATA[<p>我们知道canvas中绘制文本主要有两个方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx.strokeText(<span class="string">'text'</span>,x,y);</span><br><span class="line">ctx.fillText(<span class="string">'text'</span>,x,y);</span><br></pre></td></tr></table></figure><p>text - 需要绘制的文本<br>x - 文本的x坐标<br>y - 文本的y坐标</p><p>但是文本本身有宽度高度，所以要精确定位文本仅仅知道坐标还不行，还得知道坐标对应于文本本身的哪个点。<br>用Flash的概念来说，就是我们还需要知道文本的注册点在哪里。</p><p>canvas中有两个属性来设置文本的注册点：<strong>textAlign</strong>和<strong>textBaseline</strong><br><a id="more"></a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx.textAlign = <span class="string">"left"</span> || <span class="string">"right"</span> || <span class="string">"center"</span> || <span class="string">"start"</span> || <span class="string">"end"</span>;</span><br><span class="line">ctx.textBaseline = <span class="string">"top"</span> || <span class="string">"hanging"</span> || <span class="string">"middle"</span> || <span class="string">"alphabetic"</span> || <span class="string">"ideographic"</span> || <span class="string">"bottom"</span>;</span><br></pre></td></tr></table></figure><p>textAlign表示文本在水平方向上的对齐方式，默认值为left。<br>textBaseline表示文本在垂直方向的对齐方式，默认值为alphabetic。</p><p><img src="/blog/css/images/canvas_text_pos.png" alt="textAlign与textBaseline具体的表现"></p><p>从上图可以看到textAlign和textBaseline是如何影响文本的位置的，接下来处理文本对齐的问题。</p><p>让文本在canvas上居中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">context.font = <span class="string">'38px sans-serif'</span>;</span><br><span class="line">context.textAlign = <span class="string">'center'</span>;</span><br><span class="line">context.textBaseline = <span class="string">'middle'</span>;</span><br><span class="line">context.strokeStyle = <span class="string">'blue'</span>;</span><br><span class="line">context.strokeText(<span class="string">'What can I do for you?'</span>, canvas.width/<span class="number">2</span>,canvas.height/<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>textAlign,textBaseline分别设置为center,middle相当于将文本的注册点移动到了文本本身的中间位置，<br>所以绘制的时候只要设置坐标为canvas的中间位置即可。</p><p>如果将文本的注册点设置到文本的左上角，即start/top。<br>此时要居中文本得知道文本得高度和宽度，然后算出文本的坐标：</p><p>x = canvas.width/2-textWidth/2;<br>y = canvas.height/2-textHeight/2;</p><p>虽然measureText可以拿到文本的大概宽度，但无法获取文本的高度，<br>所以如果将注册点设置到左上角，要想居中对齐文本就没有那么精确了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我们知道canvas中绘制文本主要有两个方法：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ctx.strokeText(&lt;span class=&quot;string&quot;&gt;&#39;text&#39;&lt;/span&gt;,x,y);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ctx.fillText(&lt;span class=&quot;string&quot;&gt;&#39;text&#39;&lt;/span&gt;,x,y);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;text - 需要绘制的文本&lt;br&gt;x - 文本的x坐标&lt;br&gt;y - 文本的y坐标&lt;/p&gt;
&lt;p&gt;但是文本本身有宽度高度，所以要精确定位文本仅仅知道坐标还不行，还得知道坐标对应于文本本身的哪个点。&lt;br&gt;用Flash的概念来说，就是我们还需要知道文本的注册点在哪里。&lt;/p&gt;
&lt;p&gt;canvas中有两个属性来设置文本的注册点：&lt;strong&gt;textAlign&lt;/strong&gt;和&lt;strong&gt;textBaseline&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="canvas" scheme="https://ywxgod.github.io/blog/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>用verdaccio搭建个人用npm私服</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/use_verdaccio/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/use_verdaccio/</id>
    <published>2019-10-10T19:32:59.512Z</published>
    <updated>2019-08-19T15:44:23.736Z</updated>
    
    <content type="html"><![CDATA[<p>Verdaccio 这个怎么发音？什么意思？谷歌给出的解释：</p><blockquote><p><b><a href="https://verdaccio.org/" target="_blank" rel="noopener">Verdaccio</a></b> is an Italian name for the mixture of black, white, and yellow pigments resulting in a grayish or yellowish (depending on the proportion) soft greenish brown.</p></blockquote><h3 id="安装"><a href="#安装" class="headerlink" title="安装 - -"></a>安装 - -</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g verdaccio</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verdaccio</span><br></pre></td></tr></table></figure><p>会看到下面的输出表示安装成功。<br><code>warn --- config file  - C:\Users\flasher\AppData\Roaming\verdaccio\config.yaml</code><br><code>warn --- Plugin successfully loaded: htpasswd</code><br><code>warn --- Plugin successfully loaded: audit</code><br><code>warn --- http address - http://localhost:4873/ - verdaccio/3.10.1</code></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is the default config file. It allows all users to do anything,</span></span><br><span class="line"><span class="comment"># so don't use it on production systems.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Look here for more config file examples:</span></span><br><span class="line"><span class="comment"># https://github.com/verdaccio/verdaccio/tree/master/conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># path to a directory with all packages</span></span><br><span class="line">storage: ./storage</span><br><span class="line"><span class="comment"># path to a directory with plugins to include</span></span><br><span class="line">plugins: ./plugins</span><br><span class="line"></span><br><span class="line">web:</span><br><span class="line">  <span class="comment"># WebUI is enabled as default, if you want disable it, just uncomment this line</span></span><br><span class="line">  <span class="comment">#enable: false  # 是否启用web服务，通过web查看现有发布的私有库</span></span><br><span class="line">  title: Verdaccio</span><br><span class="line"></span><br><span class="line">auth:</span><br><span class="line">  htpasswd:</span><br><span class="line">    file: ./htpasswd</span><br><span class="line">    <span class="comment"># Maximum amount of users allowed to register, defaults to "+inf".</span></span><br><span class="line">    <span class="comment"># You can set this to -1 to disable registration.</span></span><br><span class="line">    max_users: <span class="number">-1</span> <span class="comment"># 默认值为1000，此处改为-1表示禁用用户注册</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a list of other known repositories we can talk to</span></span><br><span class="line">uplinks:</span><br><span class="line">  npmjs:</span><br><span class="line">  <span class="comment"># 当安装的包服务器没有缓存，需要去上游下载时的npm包地址</span></span><br><span class="line">  <span class="comment"># 常用的地址还有很多</span></span><br><span class="line">    url: https://registry.npmjs.org/</span><br><span class="line"></span><br><span class="line">packages:</span><br><span class="line">  <span class="string">'@*/*'</span>:</span><br><span class="line">    <span class="comment"># scoped packages</span></span><br><span class="line">    access: $all</span><br><span class="line">    publish: $authenticated <span class="comment">#以@开头的包需要用户认证才可以发布</span></span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line">  <span class="string">'**'</span>:</span><br><span class="line">    <span class="comment"># allow all users (including non-authenticated users) to read and</span></span><br><span class="line">    <span class="comment"># publish all packages</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># you can specify usernames/groupnames (depending on your auth plugin)</span></span><br><span class="line">    <span class="comment"># and three keywords: "$all", "$anonymous", "$authenticated"</span></span><br><span class="line">    access: $all</span><br><span class="line"></span><br><span class="line">    <span class="comment"># allow all known users to publish packages</span></span><br><span class="line">    <span class="comment"># (anyone can register by default, remember?)</span></span><br><span class="line">    publish: $authenticated</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if package is not available locally, proxy requests to 'npmjs' registry</span></span><br><span class="line">    proxy: npmjs</span><br><span class="line"></span><br><span class="line"><span class="comment"># To use `npm audit` uncomment the following section</span></span><br><span class="line">middlewares:</span><br><span class="line">  audit:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line"><span class="comment"># log settings</span></span><br><span class="line">logs:</span><br><span class="line">  - &#123;type: stdout, format: pretty, level: http&#125;</span><br><span class="line">  <span class="comment">#- &#123;type: file, path: verdaccio.log, level: info&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 局域网内访问地址，不然只能本机访问</span></span><br><span class="line">listen: <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">4873</span></span><br></pre></td></tr></table></figure><p>跑起来后的样子如图：</p><p><img src="/blog/css/images/run_vaderccio.jpg" alt="alt text" title="运行结果"></p>]]></content>
    
    <summary type="html">
    
      几乎零配置的npm私服，轻量，使用简单，个人使用
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="npm" scheme="https://ywxgod.github.io/blog/tags/npm/"/>
    
      <category term="node.js" scheme="https://ywxgod.github.io/blog/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>Canvas的键盘事件</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_keyboard_events/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/canvas/canvas_keyboard_events/</id>
    <published>2019-10-10T19:32:59.512Z</published>
    <updated>2019-08-19T15:44:23.725Z</updated>
    
    <content type="html"><![CDATA[<p><strong>canvas是不可获取焦点的，所以无法用canvas监听键盘事件。如果要监听键盘事件，需要用document或者window对象来监听。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'keydown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'keydown'</span>,e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'keyup'</span>,e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'keypress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'keypress'</span>,e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>如果按下的时可见字符，keypress事件会在keydown与keyup事件之间触发，否则不会触发。<br>如果按下某个可见字符持续一段时间，浏览器(谷歌)会循环触发keydown，keypress事件，直到松开按键触发一次keyup事件。</p><p><strong>要想知道按下的是哪个键，一般可以从传给事件处理函数的事件对象中获取。</strong></p><p>对于keydown，keyup事件，其事件对象的keyCode属性一般会保存按下的可见字符的ASCII码，如果是不可见字符，可以读取altKey，ctrlKey，metaKey，shiftKey这些属性来判断。<br>对于keypress事件，一定可以用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.fromCharCode(event.which)</span><br></pre></td></tr></table></figure><p>获取当前按下的字符。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;canvas是不可获取焦点的，所以无法用canvas监听键盘事件。如果要监听键盘事件，需要用document或者window对象来监听。&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr
      
    
    </summary>
    
      <category term="重学JS" scheme="https://ywxgod.github.io/blog/categories/%E9%87%8D%E5%AD%A6JS/"/>
    
    
      <category term="canvas" scheme="https://ywxgod.github.io/blog/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>Sublime Text无法安装packages的问题</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/sublime_text_3_can&#39;t_install_packages/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/sublime_text_3_can&#39;t_install_packages/</id>
    <published>2019-10-10T19:32:59.496Z</published>
    <updated>2019-08-19T15:44:23.734Z</updated>
    
    <content type="html"><![CDATA[<p>最近发现sublime text安装packages的时候不行了，老是弹出一个对话框，说没有可用的包。。。</p><p><img src="/blog/css/images/sublime_text_3_can&#39;t_install_packages_001.png" alt="没有可用的包安装"></p><p>搜了一下都没解决，后来从控制面板看到以下信息：<br><a id="more"></a></p><p><img src="/blog/css/images/sublime_text_3_can&#39;t_install_packages_002.png" alt="链接错误"></p><p>原来是 <a href="https://packagecontrol.io/channel_v3.json" target="_blank" rel="noopener">https://packagecontrol.io/channel_v3.json</a> 连不上了，被墙了？。。。</p><p>解决方法：<br>ctrl+shift+p 打开命令面板，输入 Package setttings，找到”Preferences: Package Control Settings - User”<br>加入以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"channels"</span>:[</span><br><span class="line">    <span class="string">"http://cst.stu.126.net/u/json/cms/channel_v3.json"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>将原来的地址改为国内的就行了。</p><p>不禁感叹，做一个开发挺难。<br>npmjs国内慢，大家都做镜像，更有甚者还要设置代理。。。。各种问题。。。<br>不过还好，我们总有解决问题的办法。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近发现sublime text安装packages的时候不行了，老是弹出一个对话框，说没有可用的包。。。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/css/images/sublime_text_3_can&amp;#39;t_install_packages_001.png&quot; alt=&quot;没有可用的包安装&quot;&gt;&lt;/p&gt;
&lt;p&gt;搜了一下都没解决，后来从控制面板看到以下信息：&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="sublime text" scheme="https://ywxgod.github.io/blog/tags/sublime-text/"/>
    
  </entry>
  
  <entry>
    <title>Promise与请求超时</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/use_promise/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/use_promise/</id>
    <published>2019-10-10T19:32:59.496Z</published>
    <updated>2019-08-19T15:44:23.735Z</updated>
    
    <content type="html"><![CDATA[<p>最近项目有个需求，需要对所有ajax请求增加超时处理，以前是没有的。<br>不管是axios还是原始的XMLHttpRequest都提供了超时设置，正常来说我们可以先设置一个超时时间，然后再在错误事件中区别出timeout错误，这样就可以统一处理，不过前提是你的请求应该是统一经过一个地方发出，不然修改的地方就多了。</p><p>上面的方法可以达到目的，只是不是很好，下面的有两种更妙的方法：<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms,promise</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        promise.then(resolve).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;reject(err)&#125;);</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            reject(<span class="keyword">new</span> TimeoutError(<span class="string">`超时：超过<span class="subst">$&#123;ms&#125;</span>毫秒`</span>))</span><br><span class="line">        &#125;,ms);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">调用：</span><br><span class="line"><span class="keyword">let</span> promiseRequest = ajax.getJson(<span class="string">'......'</span>);</span><br><span class="line">timeout(<span class="number">5000</span>, promiseRequest)</span><br><span class="line">    .then(success)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err <span class="keyword">instanceof</span> TimeoutError)&#123; </span><br><span class="line">            <span class="comment">//timeout </span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//other errors</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p><p>我们只需要将原来发请求的函数再封装一下.封装函数(高阶函数?).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延时函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">ms</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        setTimeout(resolve,ms);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms,promise</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.race([</span><br><span class="line">        delay(ms).then(<span class="function"><span class="params">()</span>=&gt;</span><span class="keyword">throw</span> <span class="keyword">new</span> TimeoutError(<span class="string">'....'</span>)),</span><br><span class="line">        promise</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Promise.race的原理是：提供给它并行处理的promise中，只要有一个状态发生改变，即返回此promise状态。<br>第二种方法利用Promise.race来处理正常promise和一个延时promise，调用方法跟第一种一样。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近项目有个需求，需要对所有ajax请求增加超时处理，以前是没有的。&lt;br&gt;不管是axios还是原始的XMLHttpRequest都提供了超时设置，正常来说我们可以先设置一个超时时间，然后再在错误事件中区别出timeout错误，这样就可以统一处理，不过前提是你的请求应该是统一经过一个地方发出，不然修改的地方就多了。&lt;/p&gt;
&lt;p&gt;上面的方法可以达到目的，只是不是很好，下面的有两种更妙的方法：&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="Promise" scheme="https://ywxgod.github.io/blog/tags/Promise/"/>
    
      <category term="timeout" scheme="https://ywxgod.github.io/blog/tags/timeout/"/>
    
  </entry>
  
  <entry>
    <title>ES6数组去重的三种方法</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/remove_array_duplicates_in_es6/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/remove_array_duplicates_in_es6/</id>
    <published>2019-10-10T19:32:59.481Z</published>
    <updated>2019-08-19T15:44:23.733Z</updated>
    
    <content type="html"><![CDATA[<p>ES6数组去重我们可以用以下三种方法：</p><h4 id="1-使用Set"><a href="#1-使用Set" class="headerlink" title="1. 使用Set"></a>1. 使用Set</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="built_in">console</span>.log([...new <span class="built_in">Set</span>(array)]); <span class="comment">//[ 1, 2, 3, 4, 6, 8, 9, 5, 7 ]</span></span><br></pre></td></tr></table></figure><h4 id="2-使用filter函数"><a href="#2-使用filter函数" class="headerlink" title="2. 使用filter函数"></a>2. 使用filter函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="keyword">let</span> result = array.filter(<span class="function">(<span class="params">item,index</span>)=&gt;</span>array.findIndex(<span class="function"><span class="params">i</span>=&gt;</span>i==item)==index);</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">//[1, 2, 3, 4, 6, 8, 9, 5, 7]</span></span><br></pre></td></tr></table></figure><h4 id="3-使用reduce函数"><a href="#3-使用reduce函数" class="headerlink" title="3. 使用reduce函数"></a>3. 使用reduce函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="keyword">let</span> result = array.reduce(<span class="function">(<span class="params">res,item</span>)=&gt;</span>res.includes(item)?res:[...res,item],[]);</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">//[1, 2, 3, 4, 6, 8, 9, 5, 7]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ES6数组去重我们可以用以下三种方法：&lt;/p&gt;
&lt;h4 id=&quot;1-使用Set&quot;&gt;&lt;a href=&quot;#1-使用Set&quot; class=&quot;headerlink&quot; title=&quot;1. 使用Set&quot;&gt;&lt;/a&gt;1. 使用Set&lt;/h4&gt;&lt;figure class=&quot;highlight
      
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="ES6" scheme="https://ywxgod.github.io/blog/tags/ES6/"/>
    
      <category term="Array" scheme="https://ywxgod.github.io/blog/tags/Array/"/>
    
  </entry>
  
  <entry>
    <title>用webpack打包的常见问题</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/issues_for_webpack/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/issues_for_webpack/</id>
    <published>2019-10-10T19:32:59.481Z</published>
    <updated>2019-08-19T15:44:23.729Z</updated>
    
    <content type="html"><![CDATA[<p>webpack配置项太多，要完全完美的写一个webpack配置需要了解太多的东西了，下面记录的是自己学习过程中感到比较重要的地方和处理方法，当然处理方法不止一种，这里只是其中的一种而已。<br>本文参考于：<a href="https://survivejs.com/webpack/foreword/" target="_blank" rel="noopener">https://survivejs.com/webpack/foreword/</a>，那里有详细的英文文档。</p><p><strong><a href="#如何传不同的环境变量产生不同的输出">1. 如何传不同的环境变量产生不同的输出</a></strong><br><strong><a href="#开发环境有更新时如何自动打包">2. 开发环境有更新时如何自动打包</a></strong><br><strong><a href="#如何处理图片，字体，多媒体等资源文件">3. 如何处理图片，字体，多媒体等资源文件</a></strong><br><strong><a href="#如何使用sass">4. 如何使用sass</a></strong><br><strong><a href="#如何优化CSS">5. 如何优化CSS</a></strong><br><strong><a href="#如何分块">6. 如何分块</a></strong><br><strong><a href="#如何压缩">7. 如何压缩</a></strong><br><strong><a href="#总结">8. 总结</a></strong></p><a id="more"></a><h3 id="如何传不同的环境变量产生不同的输出"><a href="#如何传不同的环境变量产生不同的输出" class="headerlink" title="如何传不同的环境变量产生不同的输出"></a>如何传不同的环境变量产生不同的输出</h3><p>webpack配置文件是一个js文件，是一个common.js标准的js模块, 我们可以在其中写js逻辑，会在node.js环境中执行。大部分情况下我们通常在webpack配置文件导出一个对象，如果将对象改为函数，就可以传参数了。根据webpack官网文档，参数可以有两个：  </p><p><em>An environment as the first parameter.</em><br><em>An options map (argv) as the second parameter.</em></p><p>如果不在编程环境使用，使用第一个参数一般就可以了，下面是例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">env</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> isDev = env === <span class="string">'development'</span>;</span><br><span class="line">    <span class="keyword">let</span> isProd = env === <span class="string">'production'</span>;</span><br><span class="line">    <span class="keyword">let</span> isTest = env === <span class="string">'test'</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        mode: </span><br><span class="line">        entry: </span><br><span class="line">        output:</span><br><span class="line">        ....</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>定义了导出函数，再看如何将参数传进去。</p><p>我们可以在package.json的scripts中定义自己的命令，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"build:prod"</span>: <span class="string">"npm run clean &amp;&amp; webpack --config build/webpack.config.js --env production"</span></span><br></pre></td></tr></table></figure></p><p>这里webpack配置文件没有放在项目跟目录，所以通过–config参数指定路径。<br><strong>–env production 这就是具体的传参方法，其中–env是参数名，production为值</strong><br>一般情况下，我们可以给–env传production，development，test三个值，也可以任意值，只要你在配置文件中对应处理即可。</p><p>这里–env传的是一个简单的字符串，其实还可以传一个对象，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"build:prod"</span>: <span class="string">"npm run clean &amp;&amp; webpack --config build/webpack.config.js --env.a production"</span></span><br></pre></td></tr></table></figure></p><p>在env对象上面定义了a属性，并设置env.a=production,同理还可以设置其他的属性env.b….<br>处理的时候就变成这样了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">env</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(env); <span class="comment">//&#123;"a":"production"&#125;</span></span><br><span class="line">    env = env.a;</span><br><span class="line">    <span class="keyword">let</span> isDev = env === <span class="string">'development'</span>;</span><br><span class="line">    <span class="keyword">let</span> isProd = env === <span class="string">'production'</span>;</span><br><span class="line">    <span class="keyword">let</span> isTest = env === <span class="string">'test'</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        mode: </span><br><span class="line">        entry: </span><br><span class="line">        output:</span><br><span class="line">        ....</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="开发环境有更新时如何自动打包"><a href="#开发环境有更新时如何自动打包" class="headerlink" title="开发环境有更新时如何自动打包"></a>开发环境有更新时如何自动打包</h3><p>自动打包，其实就是要监听到文件的改变，这个跟热加载可能有点不一样。<br>要监听文件的改变可以用<strong><a href="https://github.com/remy/nodemon" target="_blank" rel="noopener">nodemon</a></strong><br><em>Monitor for any changes in your node.js application and automatically restart the server</em></p><p>具体命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"build:dev"</span>: <span class="string">"nodemon --watch build --exec \"webpack-dev-server --compress --config build/webpack.config.js --env development\""</span></span><br></pre></td></tr></table></figure></p><p>–watch 参数表示监听build目录的改变，当build目录有文件改变时，会重新执行此命令。<br>监听业务代码目录的改变利用的是webpack-dev-server的配置，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> devServer = &#123;</span><br><span class="line">    contentBase: build_const.outputUrl,</span><br><span class="line">    port: build_const.port,</span><br><span class="line">    host: build_const.host,</span><br><span class="line">    watchContentBase: <span class="literal">true</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    stats: &#123;</span><br><span class="line">        performance: <span class="literal">true</span>,</span><br><span class="line">        chunks: <span class="literal">false</span>,</span><br><span class="line">        chunkModules: <span class="literal">false</span>,</span><br><span class="line">        chunkOrigins: <span class="literal">false</span>,</span><br><span class="line">        errors: <span class="literal">true</span>,</span><br><span class="line">        errorDetails: <span class="literal">true</span>,</span><br><span class="line">        hash: <span class="literal">false</span>,</span><br><span class="line">        timings: <span class="literal">false</span>,</span><br><span class="line">        modules: <span class="literal">false</span>,</span><br><span class="line">        warnings: <span class="literal">true</span>,</span><br><span class="line">        entrypoints: <span class="literal">false</span>,</span><br><span class="line">        children: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>关键设置 watchContentBase为true，当文件改变时，会重新加载页面。<br>还有一个问题就是，每次重新打包，需要清除上一次产生的文件，我们可以通过webpack提供的相关插件来处理，也可以用node.js实现的命令行实现，这里我用<strong><a href="https://github.com/shelljs/shx" target="_blank" rel="noopener">shx</a></strong>，具体命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"clean"</span>: <span class="string">"shx echo cleaning dirctory dist &amp;&amp; shx rm -rf dist/*"</span></span><br></pre></td></tr></table></figure></p><h3 id="如何处理图片，字体，多媒体等资源文件"><a href="#如何处理图片，字体，多媒体等资源文件" class="headerlink" title="如何处理图片，字体，多媒体等资源文件"></a>如何处理图片，字体，多媒体等资源文件</h3><p>webpack处理图片，字体，多媒体等文件都是通过设置rules来处理的。<br>需要用的loaders有：<strong><a href="https://github.com/webpack-contrib/url-loader" target="_blank" rel="noopener">url-loader</a></strong>，<strong><a href="https://github.com/webpack-contrib/file-loader" target="_blank" rel="noopener">file-loader</a></strong><br>当文件大小超过一定的阈值时，url-loader会调用file-loader来加载对于资源。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(jpg|jpeg|gif|bmp|png|ico)$/</span>,</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: <span class="number">10240</span>,</span><br><span class="line">            publicPath: <span class="string">'../'</span>,</span><br><span class="line">            name: <span class="string">'./images/[name]-[hash:8].[ext]'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(mp4|webm|ogg|mp3|wav|flac|aac|flv)(\?.*)?$/</span>,</span><br><span class="line">    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        limit: <span class="number">10240</span>,</span><br><span class="line">        publicPath: <span class="string">'../'</span>,</span><br><span class="line">        name: <span class="string">'./media/[name].[hash:8].[ext]'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(svg|eot|ttf|woff|woff2)(\?v=\d+\.\d+\.\d+)?$/</span>,</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: <span class="string">'file-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            publicPath: <span class="string">'../'</span>,</span><br><span class="line">            name: <span class="string">'./fonts/[name].[ext]'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="如何使用sass"><a href="#如何使用sass" class="headerlink" title="如何使用sass"></a>如何使用sass</h3><p>同样需要配置rules，这里需要用到<strong><a href="https://github.com/webpack-contrib/style-loader" target="_blank" rel="noopener">style-loader</a></strong>，<strong><a href="https://github.com/webpack-contrib/css-loader" target="_blank" rel="noopener">css-loader</a></strong>， <strong><a href="https://github.com/webpack-contrib/sass-loader" target="_blank" rel="noopener">sass-loader</a></strong>而sass-loader 又依赖 <strong><a href="https://github.com/topics/node-sass" target="_blank" rel="noopener">node-sass</a></strong></p><p>关于style-loader，css-loader具体的作用，可以参考下面这句话：</p><p>css-loader goes through possible @import and url() lookups within the matched files and treats them as a regular ES2015 import. If an @import points to an external resource, css-loader skips it as only internal resources get processed further by webpack.</p><p>style-loader injects the styling through a style element. The way it does this can be customized. It also implements the Hot Module Replacement interface providing for a pleasant development experience.</p><p>rules具体配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.s?[ac]ss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        <span class="string">'style-loader'</span>,</span><br><span class="line">        &#123;<span class="attr">loader</span>:<span class="string">'css-loader'</span>,<span class="attr">options</span>:&#123;<span class="attr">importLoaders</span>:<span class="number">1</span>&#125;&#125;,</span><br><span class="line">        <span class="string">'sass-loader'</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="如何优化CSS"><a href="#如何优化CSS" class="headerlink" title="如何优化CSS"></a>如何优化CSS</h3><p>从webpack的角度优化CSS，有三个阶段：     </p><h5 id="1-将css从js中分离出来。"><a href="#1-将css从js中分离出来。" class="headerlink" title="1. 将css从js中分离出来。"></a>1. 将css从js中分离出来。</h5><p>分离css需要安装插件：<strong><a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a></strong>，修改上面处理css的规则：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.s?[ac]ss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        isProd?&#123;<span class="attr">loader</span>:MiniCssExtractPlugin.loader,<span class="attr">options</span>:&#123;<span class="attr">publicPath</span>: <span class="string">'../'</span>&#125;&#125;:<span class="string">'style-loader'</span>,</span><br><span class="line">        &#123;<span class="attr">loader</span>:<span class="string">'css-loader'</span>,<span class="attr">options</span>:&#123;<span class="attr">importLoaders</span>:<span class="number">1</span>&#125;&#125;,</span><br><span class="line">        <span class="string">'sass-loader'</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>还需增加plugins配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">'./styles/[name]-[contenthash:8].css'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'./styles/chunk-[name]-[contenthash:8].css'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h5 id="2-删除无用的css。"><a href="#2-删除无用的css。" class="headerlink" title="2. 删除无用的css。"></a>2. 删除无用的css。</h5><p>删除无用的css需要安装： <strong><a href="https://github.com/isaacs/node-glob#readme" target="_blank" rel="noopener">glob</a></strong>,<strong><a href="https://github.com/FullHuman/purgecss-webpack-plugin#readme" target="_blank" rel="noopener">purgecss-webpack-plugin</a></strong>(原purifycss-webpack),<strong><a href="https://github.com/purifycss/purifycss" target="_blank" rel="noopener">purify-css</a></strong><br>增加plugins配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PurgecssPlugin = <span class="built_in">require</span>(<span class="string">'purgecss-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">let</span> purgeCSSPlugin = <span class="keyword">new</span> PurgecssPlugin(&#123;</span><br><span class="line">    paths: glob.sync(<span class="string">`<span class="subst">$&#123;build_const.sourceUrl&#125;</span>/**/*`</span>,&#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">    <span class="comment">//keyframes: true,</span></span><br><span class="line">    <span class="comment">//fontFace: true,</span></span><br><span class="line">    whitelist: <span class="function"><span class="params">()</span>=&gt;</span>build_const.purgeCssWhiteList,</span><br><span class="line">    whitelistPatterns: <span class="function"><span class="params">()</span>=&gt;</span>build_const.purgeCssWhitelistPatterns</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>purgecss-webpack-plugin插件只能在mini-css-extract-plugin插件后面使用，具体的使用方法可以参考： <strong><a href="https://www.purgecss.com/" target="_blank" rel="noopener">https://www.purgecss.com/</a></strong></p><h5 id="3-压缩css"><a href="#3-压缩css" class="headerlink" title="3. 压缩css"></a>3. 压缩css</h5><p>压缩CSS需要安装： <strong><a href="https://github.com/NMFR/optimize-css-assets-webpack-plugin" target="_blank" rel="noopener">optimize-css-assets-webpack-plugin</a></strong>, <strong><a href="https://github.com/cssnano/cssnano" target="_blank" rel="noopener">cssnano</a></strong><br>增加plugins配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OptimizeCSSAssetsPlugin = <span class="built_in">require</span>(<span class="string">"optimize-css-assets-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">let</span> zipCSSAssetsPlugin = <span class="keyword">new</span> OptimizeCSSAssetsPlugin(&#123;</span><br><span class="line">    cssProcessor: cssnano,</span><br><span class="line">    cssProcessorPluginOptions: &#123;</span><br><span class="line">        preset: [<span class="string">'default'</span>, &#123; <span class="attr">discardComments</span>: &#123; <span class="attr">removeAll</span>: <span class="literal">true</span> &#125; &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    canPrint: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h3 id="如何分块"><a href="#如何分块" class="headerlink" title="如何分块"></a>如何分块</h3><p>压缩和分块主要是针对js，可以通过三个方法进行处理：</p><h5 id="1-配置多个入口，webpack会为每个入口生成一个chunk"><a href="#1-配置多个入口，webpack会为每个入口生成一个chunk" class="headerlink" title="1. 配置多个入口，webpack会为每个入口生成一个chunk"></a>1. 配置多个入口，webpack会为每个入口生成一个chunk</h5><p>配置多个入口，可以这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    polyfill: <span class="string">'@babel/polyfill'</span>,</span><br><span class="line">    app: build_const.entryUrl</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="2-用import，require等动态加载函数实现分块"><a href="#2-用import，require等动态加载函数实现分块" class="headerlink" title="2. 用import，require等动态加载函数实现分块"></a>2. 用import，require等动态加载函数实现分块</h5><p>import,require等动态加载函数通常用在路由配置中，如：vue-router等</p><h5 id="3-用webpack4自带插件处理分块"><a href="#3-用webpack4自带插件处理分块" class="headerlink" title="3. 用webpack4自带插件处理分块"></a>3. 用webpack4自带插件处理分块</h5><p>webpack4改用隐示调用插件进行分块，需要配置optimization块，如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    runtimeChunk: &#123;</span><br><span class="line">        name: <span class="string">"manifest"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    minimizer: [uglifyjsWebpackPlugin],</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        <span class="comment">//minSize: 30000,</span></span><br><span class="line">        <span class="comment">//maxSize: 0,</span></span><br><span class="line">        cacheGroups:&#123;</span><br><span class="line">            commons:&#123;</span><br><span class="line">                test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                name: <span class="string">"vendor"</span>,</span><br><span class="line">                chunks: <span class="string">"initial"</span>,</span><br><span class="line">                minChunks: <span class="number">2</span>,</span><br><span class="line">                priority: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            styles: &#123;</span><br><span class="line">              name: <span class="string">'styles'</span>,</span><br><span class="line">              test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">              chunks: <span class="string">'all'</span>,</span><br><span class="line">              enforce: <span class="literal">true</span>,</span><br><span class="line">              priority: <span class="number">20</span>, </span><br><span class="line">            &#125;,</span><br><span class="line">            react: &#123;</span><br><span class="line">                test: <span class="regexp">/[\\/]node_modules[\\/](react|react-dom)[\\/]/</span>,</span><br><span class="line">                name: <span class="string">'react'</span>,</span><br><span class="line">                chunks: <span class="string">"initial"</span>,</span><br><span class="line">                priority: <span class="number">10</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            antd: &#123;</span><br><span class="line">                test: <span class="regexp">/[\\/]node_modules[\\/](antd|@ant-design)[\\/]/</span>,</span><br><span class="line">                name: <span class="string">'antd'</span>,</span><br><span class="line">                chunks: <span class="string">"initial"</span>,</span><br><span class="line">                priority: <span class="number">11</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>主要看cacheGroups对象内定义的对象：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">commons:&#123;</span><br><span class="line">    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">    name: <span class="string">"vendor"</span>,</span><br><span class="line">    chunks: <span class="string">"initial"</span>,</span><br><span class="line">    minChunks: <span class="number">2</span>,</span><br><span class="line">    priority: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>test</strong> 表示匹配的路径。<br><strong>name</strong> 表示块名称。<br><strong>chunks</strong> This indicates which chunks will be selected for optimization. When a string is provided, valid values are all, async, and initial. Providing all can be particularly powerful, because it means that chunks can be shared even between async and non-async chunks.<br><strong>minChunks</strong> 表示调用次数最少是多少时提取。<br><strong>priority</strong> 表示提取的优先级，值越小越早处理。</p><p>webpack有三种chunk类型：initial，normal，entry</p><p><strong>Entry chunks</strong> - Entry chunks contain webpack runtime and modules it then loads.<br><strong>Normal chunks</strong> - Normal chunks don’t contain webpack runtime. Instead, these can be loaded dynamically while the application is running. A suitable wrapper (JSONP for example) is generated for these. You generate a normal chunk in the next chapter as you set up code splitting.<br><strong>Initial chunks</strong> - Initial chunks are normal chunks that count towards initial loading time of the application. As a user, you don’t have to care about these. It’s the split between entry chunks and normal chunks that is important.</p><h3 id="如何压缩"><a href="#如何压缩" class="headerlink" title="如何压缩"></a>如何压缩</h3><p>有两个地方需要压缩：</p><h5 id="1-压缩js源码，混淆等。"><a href="#1-压缩js源码，混淆等。" class="headerlink" title="1. 压缩js源码，混淆等。"></a>1. 压缩js源码，混淆等。</h5><p>安装插件：<strong><a href="https://github.com/webpack-contrib/uglifyjs-webpack-plugin" target="_blank" rel="noopener">uglifyjs-webpack-plugin</a></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyJsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">let</span> uglifyjsWebpackPlugin = <span class="keyword">new</span> UglifyJsWebpackPlugin(&#123;</span><br><span class="line">    cache: <span class="literal">true</span>,</span><br><span class="line">    parallel: <span class="literal">true</span>,</span><br><span class="line">    sourceMap: <span class="literal">false</span>,</span><br><span class="line">    uglifyOptions:&#123;</span><br><span class="line">        ie8:<span class="literal">false</span>,</span><br><span class="line">        mangle: <span class="literal">true</span>,</span><br><span class="line">        keep_fnames: <span class="literal">false</span>,</span><br><span class="line">        toplevel: <span class="literal">false</span>,</span><br><span class="line">        compress: &#123;</span><br><span class="line">            unused: <span class="literal">true</span>,</span><br><span class="line">            dead_code: <span class="literal">true</span>,</span><br><span class="line">            drop_debugger: <span class="literal">true</span>,</span><br><span class="line">            conditionals: <span class="literal">true</span>,</span><br><span class="line">            evaluate: <span class="literal">true</span>,</span><br><span class="line">            drop_console: <span class="literal">false</span>,</span><br><span class="line">            sequences: <span class="literal">true</span>,</span><br><span class="line">            booleans: <span class="literal">true</span>,</span><br><span class="line">            warnings: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        output: &#123;</span><br><span class="line">            beautify: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>将uglifyjsWebpackPlugin添加到optimization块的minimizer数组中即可：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimizer: [uglifyjsWebpackPlugin]</span><br></pre></td></tr></table></figure></p><h5 id="2-减少js传输体积，对js进行gzip编码，一般情况会减小源文件大小。"><a href="#2-减少js传输体积，对js进行gzip编码，一般情况会减小源文件大小。" class="headerlink" title="2. 减少js传输体积，对js进行gzip编码，一般情况会减小源文件大小。"></a>2. 减少js传输体积，对js进行gzip编码，一般情况会减小源文件大小。</h5><p>安装插件：<strong><a href="https://github.com/webpack-contrib/compression-webpack-plugin" target="_blank" rel="noopener">compression-webpack-plugin</a></strong><br>增加plugins配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CompressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">'compression-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">let</span> compressionPlugin = <span class="keyword">new</span> CompressionWebpackPlugin(&#123;</span><br><span class="line">    test: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\.('</span> +build_const.gzipFileExts.join(<span class="string">'|'</span>) +<span class="string">')$'</span>),</span><br><span class="line">    threshold: <span class="number">10240</span>,</span><br><span class="line">    minRatio: <span class="number">0.8</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>gzipFileExts，包含扩展名的数组，如：[‘js’,’css’,’html’,’ico’,’jpg’,’png’,’ttf’,’woff’]</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>自己一点一点配置webpack确实是体力活，还好不管是vue还是react都提供了对应的cli命令行帮助我们创建项目，还有专门的在线生成配置的网站：<strong><a href="https://webpack.jakoblind.no/" target="_blank" rel="noopener">https://webpack.jakoblind.no/</a></strong>, <strong><a href="https://generatewebpackconfig.netlify.com/" target="_blank" rel="noopener">https://generatewebpackconfig.netlify.com/</a></strong>可以参考。不过作为前端人员，还是有必要知道webpack的每一个配置项。</p><p>最后推荐webpack配置教程：<strong><a href="https://survivejs.com/webpack/foreword/" target="_blank" rel="noopener">https://survivejs.com/webpack/foreword/</a></strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;webpack配置项太多，要完全完美的写一个webpack配置需要了解太多的东西了，下面记录的是自己学习过程中感到比较重要的地方和处理方法，当然处理方法不止一种，这里只是其中的一种而已。&lt;br&gt;本文参考于：&lt;a href=&quot;https://survivejs.com/webpack/foreword/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://survivejs.com/webpack/foreword/&lt;/a&gt;，那里有详细的英文文档。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;#如何传不同的环境变量产生不同的输出&quot;&gt;1. 如何传不同的环境变量产生不同的输出&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#开发环境有更新时如何自动打包&quot;&gt;2. 开发环境有更新时如何自动打包&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#如何处理图片，字体，多媒体等资源文件&quot;&gt;3. 如何处理图片，字体，多媒体等资源文件&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#如何使用sass&quot;&gt;4. 如何使用sass&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#如何优化CSS&quot;&gt;5. 如何优化CSS&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#如何分块&quot;&gt;6. 如何分块&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#如何压缩&quot;&gt;7. 如何压缩&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;&lt;a href=&quot;#总结&quot;&gt;8. 总结&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="webpack" scheme="https://ywxgod.github.io/blog/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>有关http-server的两个问题的解决方法</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/http-server/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/http-server/</id>
    <published>2019-10-10T19:32:59.465Z</published>
    <updated>2019-09-20T16:26:00.105Z</updated>
    
    <content type="html"><![CDATA[<ol><li>无法访问首页，或者提示ERR_INVALID_REDIRECT</li></ol>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http-server -g -p <span class="number">4205</span></span><br></pre></td></tr></table></figure><p>   运行上面的命令，然后在浏览器访问：<a href="http://localhost:4205" target="_blank" rel="noopener">http://localhost:4205</a> 你会发现无法打开首页，提示ERR_INVALID_REDIRECT<br>   如果访问：<a href="http://localhost:4205/index.html" target="_blank" rel="noopener">http://localhost:4205/index.html</a> 确能正常访问，不过如果带上history路由访问单页应用还是不行。</p><p>   目前发现0.11版本有这个问题，只要将其降级到0.9.0版本即可解决，参考以下链接：<br>   <a href="https://github.com/http-party/http-server/issues/525" target="_blank" rel="noopener">https://github.com/http-party/http-server/issues/525</a> 0.9.0以上其他版本是否有同样的问题未知。</p>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall http-server -g</span><br><span class="line">npm install http-server@<span class="number">0.9</span> -g</span><br></pre></td></tr></table></figure><ol start="2"><li>单页应用时http-server不支持history模式的路由</li></ol><p>   先安装spa-http-server，然后在http-server启动参数增加–push-state即可。</p>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install spa-http-server</span><br><span class="line">http-server -g -p <span class="number">4205</span> --push-state</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;无法访问首页，或者提示ERR_INVALID_REDIRECT&lt;/li&gt;
&lt;/ol&gt;
   &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="http-server" scheme="https://ywxgod.github.io/blog/tags/http-server/"/>
    
  </entry>
  
  <entry>
    <title>HTTP访问控制CORS</title>
    <link href="https://ywxgod.github.io/blog/2019/10/11/http_cors/"/>
    <id>https://ywxgod.github.io/blog/2019/10/11/http_cors/</id>
    <published>2019-10-10T19:32:59.465Z</published>
    <updated>2019-08-19T15:44:23.728Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要分一下几个部分：</p><ol><li><a href="#定义CORS"><strong>定义CORS</strong></a></li><li><a href="#同源"><strong>同源</strong></a></li><li><a href="#可能产生跨域的情况"><strong>可能产生跨域的情况</strong></a></li><li><a href="#预检请求preflight request"><strong>预检请求preflight request</strong></a></li><li><a href="#简单请求"><strong>简单请求</strong></a></li><li><a href="#带身份凭证的请求"><strong>带身份凭证的请求</strong></a></li><li><a href="#相关HTTP请求头字段"><strong>相关HTTP请求头字段</strong></a></li><li><a href="#相关HTTP响应头字段"><strong>相关HTTP响应头字段</strong></a><a id="more"></a></li></ol><h3 id="定义CORS"><a href="#定义CORS" class="headerlink" title="定义CORS"></a>定义CORS</h3><p>CORS是一种跨域资源共享机制，使用额外的HTTP头告诉浏览器，让运行在某个origin上的web应用可以访问来自不同origin服务器上的资源。</p><h3 id="同源"><a href="#同源" class="headerlink" title="同源"></a>同源</h3><p>当请求的双方所用协议，端口，域名都相同时，即为同源，否则为不同源。不同源的请求为跨域请求。</p><h3 id="可能产生跨域的情况"><a href="#可能产生跨域的情况" class="headerlink" title="可能产生跨域的情况"></a>可能产生跨域的情况</h3><ol><li>XMLHttpRequest或Fetch发起的跨域HTTP请求</li><li>Web字体，即通过@font-face使用跨域字体资源</li><li>WebGL贴图</li><li>drawImage向canvas绘制images/video画面时</li></ol><h3 id="预检请求preflight-request"><a href="#预检请求preflight-request" class="headerlink" title="预检请求preflight request"></a>预检请求preflight request</h3><p>对那些可能对服务器数据产生副作用的HTTP请求方法，特别是GET方法以外的HTTP请求，或者搭配某些MIME类型的POST请求，浏览器在发送请求之前必须用OPTIONS方法发送一个预检请求，浏览器从预检请求获知服务端是否允许跨域，是否允许携带身份凭证。</p><p>当满足以下任一条件，浏览器会先发送预检请求：</p><ul><li>使用了下面任一HTTP方法：<ul><li>PUT</li><li>DELETE</li><li>CONNECT</li><li>OPTIONS</li><li>TRACE</li><li>PATCH</li></ul></li><li>人为设置了CORS安全头字段集合之外的头字段。该集合为：<ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Content-Type(Content-Type有额外的限制)</li><li>DPR</li><li>Downlink</li><li>Save-Data</li><li>Viewport-Width</li><li>Width</li></ul></li><li>Content-Type值不属于下列值之一：<ul><li>text/plain</li><li>multipart/form-data</li><li>application/x-www-form-urlencoded</li></ul></li><li>请求中的XMLHttpRequestUpload对象注册了任意多个事件监听器。</li><li>请求中使用了ReadableStream对象。</li></ul><h3 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h3><p>同时满足以下5个条件的请求，视为简单请求，浏览器在发送简单请求时不会发送预检请求。</p><ul><li>使用下列方法之一：<ul><li>GET</li><li>HEAD</li><li>POST</li></ul></li><li>请求头中不包含CORS安全头定义字段集合外的字段，该集合为：<ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Content-Type(Content-Type有额外的限制)</li><li>DPR</li><li>Downlink</li><li>Save-Data</li><li>Viewport-Width</li><li>Width</li></ul></li><li>Content-Type的值仅限于下列三者之一：<ul><li>text/plain</li><li>multipart/form-data</li><li>application/x-www-form-urlencoded</li></ul></li><li>请求中的任意XMLHttpRequestUpload对象均没有注册任何事件监听器</li><li>请求中没有使用ReadableStream对象。</li></ul><h3 id="带身份凭证的请求"><a href="#带身份凭证的请求" class="headerlink" title="带身份凭证的请求"></a>带身份凭证的请求</h3><p>XMLHttpRequest或Fetch发起的跨域HTTP请求，浏览器不会携带身份凭证信息。</p><p>如果要发送凭证信息：<br>XMLHttpRequest需要设置withCredentials为true。<br>Fetch需要设置init对象的credentials为include或者same-origin。<br>即使浏览器发送了凭证信息，如果服务器响应头没有Access-Control-Allow-Credentials：true，浏览器也不会把响应内容返回给请求者。<br>总的来说，就是要客户端设置相应的Credentials为true，服务器端响应头也需要增加Access-Control-Allow-Credentials：true。</p><h3 id="相关HTTP请求头字段"><a href="#相关HTTP请求头字段" class="headerlink" title="相关HTTP请求头字段"></a>相关HTTP请求头字段</h3><p><code>Origin</code><br>表示请求的源站，值为源站URI。它不包含任何路径信息，只是服务器名称。不管是否为跨域请求，此字段总是被发送。</p><p><code>Access-Control-Request-Method</code><br>用于预检请求，告诉服务器实际请求将要使用的方法，如：Access-Control-Request-Method：PUT</p><p><code>Access-Control-Request-Headers</code><br>用于预检请求，告诉实际请求所携带的请求头字段</p><h3 id="相关HTTP响应头字段"><a href="#相关HTTP响应头字段" class="headerlink" title="相关HTTP响应头字段"></a>相关HTTP响应头字段</h3><p><code>Access-Control-Allow-Origin</code><br>指定允许访问该资源的外域URI，对于不需要携带身份凭证的请求，服务器可以指定该字段值为通配符，表示允许来自所有域的请求访问该资源。如果服务器指定了具体的域名而非通配符，那么响应头中Vary字段必须包含Origin，这将告诉客户端，服务器对不同的源站返回不同的内容。</p><p><code>Access-Control-Expose-Headers</code><br>跨域访问时，默认情况下浏览器只能读取一些常用响应头，如：Cache-Control， Content-Type，Content-Language等，如果要访问其他响应头，这需要设置此值。如：Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header。这样浏览器就能访问自定义的响应头：X-My-Custom-Header, X-Another-Custom-Header</p><p><code>Access-Control-Max-Age</code><br>指定预检请求的结果能被浏览器缓存多久(以秒为单位)。在有效时间内，浏览器无须为同一请求再次发起预检请求。</p><p><code>Access-Control-Allow-Credentials</code><br>指定了当浏览器的credentials设为true时，是否允许浏览器读取response内容。</p><p><code>Access-Control-Allow-Methods</code><br>用于预检请求的响应头，指明实际请求所允许使用的HTTP方法</p><p><code>Access-Control-Allow-Headers</code><br>用于预检请求的响应头，指明实际请求所允许使用的HTTP请求头字段</p><p>本文大部分内容来自于MDN相关代码示例参考： <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">HTTP访问控制CORS</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要分一下几个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#定义CORS&quot;&gt;&lt;strong&gt;定义CORS&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#同源&quot;&gt;&lt;strong&gt;同源&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#可能产生跨域的情况&quot;&gt;&lt;strong&gt;可能产生跨域的情况&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#预检请求preflight request&quot;&gt;&lt;strong&gt;预检请求preflight request&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#简单请求&quot;&gt;&lt;strong&gt;简单请求&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#带身份凭证的请求&quot;&gt;&lt;strong&gt;带身份凭证的请求&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#相关HTTP请求头字段&quot;&gt;&lt;strong&gt;相关HTTP请求头字段&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#相关HTTP响应头字段&quot;&gt;&lt;strong&gt;相关HTTP响应头字段&lt;/strong&gt;&lt;/a&gt;
    
    </summary>
    
      <category term="code" scheme="https://ywxgod.github.io/blog/categories/code/"/>
    
    
      <category term="跨域" scheme="https://ywxgod.github.io/blog/tags/%E8%B7%A8%E5%9F%9F/"/>
    
      <category term="CORS" scheme="https://ywxgod.github.io/blog/tags/CORS/"/>
    
  </entry>
  
</feed>
